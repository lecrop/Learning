<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Francisco Porcel-Pastrana">

<title>Learning - Alternative Splicing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.30/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<script src="site_libs/jszip-1.13.4/jszip.min.js"></script>
<link href="site_libs/dt-ext-buttons-1.13.4/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="site_libs/dt-ext-buttons-1.13.4/js/dataTables.buttons.min.js"></script>
<script src="site_libs/dt-ext-buttons-1.13.4/js/buttons.html5.min.js"></script>
<script src="site_libs/dt-ext-buttons-1.13.4/js/buttons.colVis.min.js"></script>
<script src="site_libs/dt-ext-buttons-1.13.4/js/buttons.print.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Learning</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Búsqueda en BBDDs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./RNAseq.html" rel="" target="">
 <span class="menu-text">Bulk RNAseq</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./AS_Analysis.html" rel="" target="" aria-current="page">
 <span class="menu-text">Alternative Splicing</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#matt" id="toc-matt" class="nav-link active" data-scroll-target="#matt"><span class="header-section-number">1</span> Matt</a>
  <ul class="collapse">
  <li><a href="#instalación-de-matt" id="toc-instalación-de-matt" class="nav-link" data-scroll-target="#instalación-de-matt"><span class="header-section-number">1.1</span> Instalación de matt</a></li>
  <li><a href="#instalación-de-sra-toolkit" id="toc-instalación-de-sra-toolkit" class="nav-link" data-scroll-target="#instalación-de-sra-toolkit"><span class="header-section-number">1.2</span> Instalación de SRA-Toolkit</a></li>
  <li><a href="#cargar-los-datos-del-dataset-seleccionados" id="toc-cargar-los-datos-del-dataset-seleccionados" class="nav-link" data-scroll-target="#cargar-los-datos-del-dataset-seleccionados"><span class="header-section-number">1.3</span> Cargar los datos del dataset seleccionados</a></li>
  </ul></li>
  <li><a href="#vast-tools" id="toc-vast-tools" class="nav-link" data-scroll-target="#vast-tools"><span class="header-section-number">2</span> Vast-Tools</a>
  <ul class="collapse">
  <li><a href="#instalación-de-vast-tools" id="toc-instalación-de-vast-tools" class="nav-link" data-scroll-target="#instalación-de-vast-tools"><span class="header-section-number">2.1</span> Instalación de Vast-Tools</a></li>
  <li><a href="#instalación-de-bowtie" id="toc-instalación-de-bowtie" class="nav-link" data-scroll-target="#instalación-de-bowtie"><span class="header-section-number">2.2</span> Instalación de bowtie</a></li>
  <li><a href="#teoría-sobre-el-splicing-alternativo" id="toc-teoría-sobre-el-splicing-alternativo" class="nav-link" data-scroll-target="#teoría-sobre-el-splicing-alternativo"><span class="header-section-number">2.3</span> Teoría sobre el Splicing Alternativo</a></li>
  <li><a href="#alineamineto-para-splicing-alternativo-sa" id="toc-alineamineto-para-splicing-alternativo-sa" class="nav-link" data-scroll-target="#alineamineto-para-splicing-alternativo-sa"><span class="header-section-number">2.4</span> Alineamineto para Splicing Alternativo (SA)</a>
  <ul class="collapse">
  <li><a href="#definiciones" id="toc-definiciones" class="nav-link" data-scroll-target="#definiciones"><span class="header-section-number">2.4.1</span> Definiciones</a></li>
  <li><a href="#alineamiento" id="toc-alineamiento" class="nav-link" data-scroll-target="#alineamiento"><span class="header-section-number">2.4.2</span> Alineamiento</a></li>
  </ul></li>
  <li><a href="#creación-de-tabla-de-datos-conjunta" id="toc-creación-de-tabla-de-datos-conjunta" class="nav-link" data-scroll-target="#creación-de-tabla-de-datos-conjunta"><span class="header-section-number">2.5</span> Creación de tabla de datos conjunta</a></li>
  <li><a href="#comparación-entre-grupos-análisis-de-splicing-diferencial" id="toc-comparación-entre-grupos-análisis-de-splicing-diferencial" class="nav-link" data-scroll-target="#comparación-entre-grupos-análisis-de-splicing-diferencial"><span class="header-section-number">2.6</span> Comparación entre grupos (Análisis de Splicing diferencial)</a>
  <ul class="collapse">
  <li><a href="#definiciones-1" id="toc-definiciones-1" class="nav-link" data-scroll-target="#definiciones-1"><span class="header-section-number">2.6.1</span> Definiciones</a></li>
  <li><a href="#procedimiento-en-terminal" id="toc-procedimiento-en-terminal" class="nav-link" data-scroll-target="#procedimiento-en-terminal"><span class="header-section-number">2.6.2</span> Procedimiento en terminal</a></li>
  <li><a href="#procedimiento-en-r" id="toc-procedimiento-en-r" class="nav-link" data-scroll-target="#procedimiento-en-r"><span class="header-section-number">2.6.3</span> Procedimiento en R</a></li>
  </ul></li>
  <li><a href="#analisis-de-enriquecimiento-de-differenctial-splicing" id="toc-analisis-de-enriquecimiento-de-differenctial-splicing" class="nav-link" data-scroll-target="#analisis-de-enriquecimiento-de-differenctial-splicing"><span class="header-section-number">2.7</span> Analisis de Enriquecimiento de Differenctial Splicing</a>
  <ul class="collapse">
  <li><a href="#paquete-1" id="toc-paquete-1" class="nav-link" data-scroll-target="#paquete-1"><span class="header-section-number">2.7.1</span> Paquete 1</a></li>
  <li><a href="#paquete-2" id="toc-paquete-2" class="nav-link" data-scroll-target="#paquete-2"><span class="header-section-number">2.7.2</span> Paquete 2</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#otros-paquetes-de-interés" id="toc-otros-paquetes-de-interés" class="nav-link" data-scroll-target="#otros-paquetes-de-interés"><span class="header-section-number">3</span> Otros paquetes de interés</a>
  <ul class="collapse">
  <li><a href="#psichomics" id="toc-psichomics" class="nav-link" data-scroll-target="#psichomics"><span class="header-section-number">3.1</span> PSIchomics</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Alternative Splicing</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Francisco Porcel-Pastrana </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="matt" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Matt</h1>
<p><a href="https://gitlab.com/aghr/matt">Matt</a> es un paquete diseñado por Dr.&nbsp;Manuel Irimia para el análisis de eventos de splicing alternativo. Incluye funciones básicas para la manipulación de tablas, extracción de características relacionadas con exones e intrones, análisis de características discriminantes, mapas de motivos para proteínas de unión a ARN, etc. Cita:</p>
<p>Gohr, A., &amp; Irimia, M. (2019). Matt: Unix tools for alternative splicing analysis. Bioinformatics (Oxford, England), 35(1), 130–132. https://doi.org/10.1093/bioinformatics/bty606</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Trabajamos en Terminal</strong>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="instalación-de-matt" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="instalación-de-matt"><span class="header-section-number">1.1</span> Instalación de matt</h2>
<p>En el terminal, nos movemos a la carpeta donde queramos guardar Matt en nuestro ordenador o superordenador. Una vez ahí tenemos que crear un clon del repositorio de git:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>git clone https<span class="sc">:</span><span class="er">//</span>gitlab.com<span class="sc">/</span>aghr<span class="sc">/</span>matt.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación, tenemos que ejecutar el script de instalación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>chmod u<span class="sc">+</span>rwx .<span class="sc">/</span>INSTALL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y corremos el script:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>.<span class="sc">/</span>INSTALL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez tengamos instalado Matt temenos que hacer que sus funciones formen parte del PATH para que se pueda ejecutar desde cualquier carpeta. Esto lo hacemos con la siguiente línea de comandos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>export PATH<span class="ot">=</span><span class="er">~/</span>directorio<span class="sc">/</span>donde<span class="sc">/</span>hayas<span class="sc">/</span>guardado<span class="sc">/</span>matt<span class="sc">:</span><span class="er">$</span>PATH</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>echo <span class="st">'export PATH=~ directorio/donde/hayas/guardado/matt:$PATH'</span> <span class="sc">&gt;</span><span class="er">&gt;</span> <span class="er">~/</span>.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para comprobar que temenos matt instalado Podemos hacer la prueba de esctibir en el terminal el propio nombre:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>matt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y el output que nos debe devolver es el siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Matt v. <span class="dv">1</span>.<span class="fl">3.1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Usage<span class="sc">:</span> matt <span class="sc">&lt;</span>command<span class="sc">&gt;</span> ...</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Commands<span class="sc">:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="er">*</span>Import data <span class="sc">/</span> check table                             <span class="sc">*</span>Maths and statistics</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  chk_nls<span class="sc">:</span>  check newlines <span class="cf">in</span> table                      col_calc<span class="sc">:</span>  apply calculations to columns</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>..</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  test_regexp_enrich<span class="sc">:</span> test REGEXP enrichment</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>Attention<span class="sc">:</span> Tables processed by Matt must contain a header with column names and must not contain <span class="st">" characters with exception of regular expressions. All other "</span> characters will be ignored and removed. When using MS Excel <span class="cf">for</span> table generation, please save tables <span class="cf">in</span> format Windows Text. Matt recognizes Windows newlines, but not DOS nor old<span class="sc">-</span>style MacOS <span class="fu">newlines</span> (CR or \r only). Use command chk_nls to see and check newlines <span class="cf">in</span> tables.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez instalado matt, es necesario comprobar que temenos instalado una de las herramientas del NCBI que es la que utiliza para funcionar: SRA-Tool Kit.</p>
</section>
<section id="instalación-de-sra-toolkit" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="instalación-de-sra-toolkit"><span class="header-section-number">1.2</span> Instalación de SRA-Toolkit</h2>
<p>Para comprobar si la temenos, en debemos hacer la prueba de esctibir en el terminal una de sus funciones, como por ejemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sra</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y el output que nos debe devolver es el siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sra<span class="sc">-</span>pileup             sra<span class="sc">-</span>search<span class="fl">.3</span>           sra<span class="sc">-</span>sort<span class="sc">-</span>cg.<span class="dv">3</span>.<span class="fl">0.7</span>      sra<span class="sc">-</span>stat.<span class="dv">3</span>.<span class="fl">0.7</span>         sratools.<span class="dv">3</span>.<span class="fl">0.7</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sra<span class="sc">-</span>pileup<span class="sc">-</span>orig.<span class="dv">3</span>.<span class="fl">0.7</span>  sra<span class="sc">-</span>search.<span class="dv">3</span>.<span class="fl">0.7</span>       sra<span class="sc">-</span>sort<span class="fl">.3</span>             srapath</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>sra<span class="sc">-</span>pileup<span class="fl">.3</span>           sra<span class="sc">-</span>sort               sra<span class="sc">-</span>sort.<span class="dv">3</span>.<span class="fl">0.7</span>         srapath<span class="sc">-</span>orig.<span class="dv">3</span>.<span class="fl">0.7</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sra<span class="sc">-</span>pileup.<span class="dv">3</span>.<span class="fl">0.7</span>       sra<span class="sc">-</span>sort<span class="sc">-</span>cg            sra<span class="sc">-</span>stat               srapath<span class="fl">.3</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sra<span class="sc">-</span>search             sra<span class="sc">-</span>sort<span class="sc">-</span>cg<span class="fl">.3</span>          sra<span class="sc">-</span>stat<span class="fl">.3</span>             srapath.<span class="dv">3</span>.<span class="fl">0.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>También debemos comprobar la versión de que tenemos instalada (debe de ser superior a la 2.8.0):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>vdb<span class="sc">-</span>config –version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El output será el siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>SRA<span class="sc">-</span>Toolkit <span class="dv">3</span>.<span class="fl">0.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si tienes la última versión guay, sino tienes que instalarla mediante los siguientes comandos en el terminal (comando cogidos de la página oficial para Linux, si tienes Mac o Windows busca en la página principal de SRA (<a href="https://github.com/ncbi/sra-tools/wiki/02.-Installing-SRA-Toolkit">enlace</a>) la forma de instalarlo).</p>
<p>Primero descargamos la herramienta (recomendable crear una carpeta donde meterlo)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>wget <span class="sc">--</span>output<span class="sc">-</span>document sratoolkit.tar.gz https<span class="sc">:</span><span class="er">//</span>ftp<span class="sc">-</span>trace.ncbi.nlm.nih.gov<span class="sc">/</span>sra<span class="sc">/</span>sdk<span class="sc">/</span>current<span class="sc">/</span>sratoolkit.current<span class="sc">-</span>ubuntu64.tar.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación lo instalamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tar <span class="sc">-</span>vxzf sratoolkit.tar.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación metemos la herramienta en el PATH:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>export PATH<span class="ot">=</span><span class="er">~/</span>directorio<span class="sc">/</span>donde<span class="sc">/</span>hayas<span class="sc">/</span>guardado<span class="sc">/</span>sratoolkit.current<span class="sc">-</span>ubuntu64.tar.gz<span class="sc">/</span>bin<span class="sc">:</span><span class="er">$</span>PATH</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>echo <span class="st">'export PATH=~ directorio/donde/hayas/guardado/sratoolkit.current-ubuntu64.tar.gz/bin:$PATH'</span> <span class="sc">&gt;</span><span class="er">&gt;</span> <span class="er">~/</span>.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación es recommendable comprobar que funciona:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>which fastq<span class="sc">-</span>dump</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El output será el siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span>Users<span class="sc">/</span>JoeUser<span class="sc">/</span>sratoolkit.current<span class="sc">-</span>ubuntu64.tar.gz<span class="sc">/</span>bin <span class="sc">/</span>fastq<span class="sc">-</span>dump</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>También podemos probar que sea funcional:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fastq<span class="sc">-</span>dump <span class="sc">--</span>stdout <span class="sc">-</span>X <span class="dv">2</span> SRR390728</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El output será el siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Read <span class="dv">2</span> spots <span class="cf">for</span> SRR390728</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Written <span class="dv">2</span> spots <span class="cf">for</span> SRR390728</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>SRR390728<span class="fl">.1</span> <span class="dv">1</span> length<span class="ot">=</span><span class="dv">72</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>CATTCTTCACGTAGTTCTCGAGCCTTGGTTTTCAGCGATGGAGAATGACTTTGACAAGCTGAGAGAAGNTNC</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>SRR390728<span class="fl">.1</span> <span class="dv">1</span> length<span class="ot">=</span><span class="dv">72</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>;;;;;;;;;;;;;;;;;;;;;;;;;;;<span class="dv">9</span>;;<span class="dv">665142</span>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<span class="dv">96</span><span class="sc">&amp;&amp;</span><span class="er">&amp;&amp;</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>SRR390728<span class="fl">.2</span> <span class="dv">2</span> <span class="at">length=</span><span class="dv">72</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>AAGTAGGTCTCGTCTGTGTTTTCTACGAGCTTGTGTTCCAGCTGACCCACTCCCTGGGTGGGGGGACTGGGT</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>SRR390728<span class="fl">.2</span> <span class="dv">2</span> <span class="at">length=</span><span class="dv">72</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>;;;;;;;;;;;;;;;;;<span class="dv">4</span>;;;;<span class="dv">3</span>;<span class="fl">393.1</span><span class="sc">+</span><span class="dv">4</span><span class="sc">&amp;&amp;</span><span class="dv">5</span><span class="sc">&amp;&amp;</span>;;;;;;;;;;;;;;;;;;;;;<span class="sc">&lt;</span><span class="dv">9</span>;<span class="sc">&lt;</span>;;;;;<span class="dv">464262</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>Todo lo hecho a partir de aquí está en:</em></p>
<p><a href="./Terminales Guardados/Terminal_9-14-23.txt"><code>Terminal_9-14-23.txt</code></a></p>
</div>
</div>
</section>
<section id="cargar-los-datos-del-dataset-seleccionados" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="cargar-los-datos-del-dataset-seleccionados"><span class="header-section-number">1.3</span> Cargar los datos del dataset seleccionados</h2>
<p>Para cargar los datos vamos a usar una función de <code>matt</code> (<code>retr_rnaseq</code>) que permite al usuario recuperar datos de ARN-seq del Gene Expression Omnibus (GEO), un repositorio público donde muchos investigadores almacenan sus datos de ARN-seq relacionados con sus publicaciones. Teniendo a mano los números de acceso GEO de los conjuntos de datos RNA-seq, este comando descarga los archivos SRA, extrae las lecturas de ARN-seq como archivos FASTQ o FASTA y, si lo desea renombra los archivos FASTA/FASTQ extraídos como especifique el usuario.</p>
<p>Para ello tenemos que crear un <code>.txt</code> (con los nombres separados por un tab) como en el ejemplo:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Images/Picture23.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Imagen 1</figcaption>
</figure>
</div>
<p>Una vez que lo tenemos creado tenemos que subirlo a la misma carpeta en la que vayamos a hacer la descarga de los datos y los análisis. El siguiente paso es descargar de GEO los <code>.gz</code> de las muestras seleccionadas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>matt retr_rnaseq accession_numbers.txt <span class="sc">-</span>keepsra <span class="sc">-</span>o rnaseq_data <span class="sc">-</span>p <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con este comando lo que hacemos es que se descarguen lo indicado (indicando el documento en el que se encuentran los datos, sin borrar los archivos SRA (<code>-keepsra</code>) en una carpeta nueva (<code>-o rnaseq_data</code>) y que el trabajo se divida entre 6 cores del superordenador (<code>-p 6</code>)</p>
<p>Este comando tarda bastante por lo que es recomendable usar los siguientes <strong>comandos para poner en segundo plano un trabajo y desvincularlos de la sesión de trabajo</strong>, lo cual es recomendable porque nos permitirá continuar trabajando en el servidor mientras se están ejecutando los trabajos mandados. Otra ventaja es que, al desvincularlos de la sesión de trabajo podremos cerrar el terminal sin preocuparnos de que se paren los procesos. Si cerráramos el terminal sin desvincular el trabajo de nuestra sesión (la sesión está asociada al terminal de trabajo) este trabajo se interrumpiría en el momento de cerrar el terminal (y, por lo tanto, la sesión). Para ello debemos ejecutar lo siguientes comandos:</p>
<ol type="1">
<li>Ejecutamos el trabajo que queramos hacer, en nuestro caso usaremos el ejemplo anterior:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>matt retr_rnaseq accession_numbers.txt <span class="sc">-</span>keepsra <span class="sc">-</span>o rnaseq_data <span class="sc">-</span>p <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Tras esto comenzará a ejecutarse. En este momento tenemos que <strong>parar el proceso</strong> con la combinación de teclas <code>Control + z</code>. El output debe ser el siguiente:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>]<span class="sc">+</span>  Stopped                 matt retr_rnaseq accession_numbers.txt <span class="sc">-</span>keepsra <span class="sc">-</span>o rnaseq_data <span class="sc">-</span>p <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>En este punto tendremos el proceso parado y podremos escribir comandos. Lo siguiente que debemos hacer es mandar el trabajo a <strong>ejecutarse en segundo plano</strong> (mandar al background) con el siguiente comando:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bg</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Output:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>]<span class="sc">+</span> matt retr_rnaseq accession_numbers.txt <span class="sc">-</span>keepsra <span class="sc">-</span>o rnaseq_data <span class="sc">-</span>p <span class="dv">6</span> <span class="sc">&amp;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Y significará que se ha reanudado la ejecución en segundo plano. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Y significará que se ha reanudado la ejecución en segundo plano.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>matt retr_rnaseq accession_numbers.txt <span class="sc">-</span>keepsra <span class="sc">-</span>o rnaseq_data <span class="sc">-</span>p <span class="dv">6</span> <span class="sc">&amp;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Una vez que hayamos ejecutado el proceso en segundo plano pasamos al siguiente paso que es <strong>desvincular el proceso del terminal</strong> (sesión) en el que lo hemos corrido para que continúe ejecutándose si cerramos sesión. Para ello usamos el comando:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>disown</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El output del terminal no se guardará en ningún lado si los cerramos (el terminal) de manera que si queremos dejar un proceso funcionando y luego poder consultar qué mensajes nos ha dado el proceso (para chequear si ha ido bien o ha habido algún error durante el procesamiento). Podemos hacer que los mensajes que saldrían en el terminal se guarden en un <code>.txt</code> para luego poder consultarlos utilizando el siguiente comando:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Proceso_mandado_a_ejecutar <span class="dv">1</span><span class="sc">&gt;</span>Nombre_que_le_quieras_poner_al_documento.out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este comando debe de utilizarse de la siguiente manera (en el siguiente ejemplo mi documento se llamará documento_ejemplo.out y lo voy a ejecutar directamente en segundo plano con el comando “&amp;” previamente explicado):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>matt retr_rnaseq accession_numbers.txt <span class="sc">-</span>keepsra <span class="sc">-</span>o rnaseq_data <span class="sc">-</span>p <span class="dv">6</span> <span class="dv">1</span><span class="sc">&gt;</span>documento_ejemplo.out <span class="sc">&amp;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con esto haremos que se guarde un documento <code>.out</code> (que se puede leer como <code>.txt</code>) en la carpeta en la que estemos trabajando y que el proceso se lance directamente en segundo plano por lo que solo necesitaríamos aplicar el comando <code>disown</code> para desvincularlo de la sesión y podremos descuidarnos.</p>
<p>Los datos se nos descargaran en la carpeta rnaseq_data que hemos escrito en el código ejecutado. Cuando finalice, accedemos a esa carpeta y ejecutamos el comando <code>ls</code> (para ver el listado de archivos que contiene esta carpeta) veremos lo siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Basal_2_1.fastq.gz      Luminal_1_1.fastq.gz        Luminal_2_1.fastq.gz    SRR1919599.sra      SRR1919603.sra</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Basal_2_2.fastq.gz      Luminal_2_2.fastq.gz    SRR1919600.sra          SRR1919604.sra  dataset_info.tab</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Basal_1_1.fastq.gz              Basal_3_1.fastq.gz          Luminal_3_1.fastq.gz    SRR1919601.sra      Basal_1_2.fastq.gz          </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>Basal_3_2.fastq.gz      Luminal_1_2.fastq.gz        Luminal_3_2.fastq.gz    SRR1919602.sra  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez en este punto comenzaremos el alineamiento con Vast-Tools.</p>
</section>
</section>
<section id="vast-tools" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Vast-Tools</h1>
<p><strong>Vertebrate Alternative Splicing and Transcription Tools (VAST-TOOLS)</strong> es un conjunto de herramientas para perfilar y comparar eventos de splicing alternativo en datos de RNA-Seq. Es especialmente adecuado para comparaciones evolutivas. Funciona en sinergia con el servidor web <em>VastDB</em> y <em>Matt</em>, un conjunto de herramientas para el análisis posterior del splicing alternativo. <a href="https://github.com/vastgroup/vast-tools">Enlace a GitHub</a>. Citas:</p>
<ul>
<li><strong><em>Capítulo de libro donde viene todo incluso un ejemplo</em></strong>: Gohr, A., Mantica, F., Hermoso-Pulido, A., Tapial, J., Márquez, Y., &amp; Irimia, M. (2022). Computational Analysis of Alternative Splicing Using VAST-TOOLS and the VastDB Framework. Methods in molecular biology (Clifton, N.J.), 2537, 97–128. https://doi.org/10.1007/978-1-0716-2521-7_7</li>
<li><strong><em>Artículo original</em></strong>: Irimia, M., Weatheritt, R.J., Ellis, J., Parikshak, N.N., Gonatopoulos-Pournatzis, T., Babor, M., Quesnel-Vallières, M., Tapial, J., Raj, B., O’Hanlon, D., Barrios-Rodiles, M., Sternberg, M.J.E., Cordes, S.P., Roth, F.P., Wrana, J.L., Geschwind, D.H., Blencowe, B.B. (2014). A highly conserved program of neuronal microexons is misregulated in autistic brains. Cell, 59:1511-23.</li>
<li><strong><em>Artículo principal</em></strong>: Tapial, J., Ha, K.C.H., Sterne-Weiler, T., Gohr, A., Braunschweig, U., Hermoso-Pulido, A., Quesnel-Vallières, M., Permanyer, J., Sodaei, R., Marquez, Y., Cozzuto, L., Wang, X., Gómez-Velázquez, M., Rayón, M., Manzanares, M., Ponomarenko, J., Blencowe, B.J., Irimia, M. (2017). An atlas of alternative splicing profiles and functional associations reveals new regulatory programs and genes that simultaneously express multiple major isoforms. Genome Res, 27(10):1759-1768</li>
<li><strong><em>Artículo de análisis de Intron Retention</em></strong>: Braunschweig, U., Barbosa-Morais, N.L., Pan, Q., Nachman, E., Alipahani, B., Gonatopoulos-Pournatzis, T., Frey, B., Irimia, M., Blencowe, B.J. (2014). Widespread intron retention in mammals functionally tunes transcriptomes. Genome Research, 24:1774-86</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Trabajamos en Terminal</strong>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="instalación-de-vast-tools" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="instalación-de-vast-tools"><span class="header-section-number">2.1</span> Instalación de Vast-Tools</h2>
<p>En el terminal, tenemos que crear un clon del repositorio de git:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>git clone https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>vastgroup<span class="sc">/</span>vast<span class="sc">-</span>tools.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Esto nos va a crear una carpeta en el directorio donde hagamos la clonación que se llamará <code>vast-tools</code>. Debemos acceder a esta carpeta y tenemos que crear una nueva carpeta que se llame “VASTDB” (con el comando <code>mkdir VASTDB</code>) con el cual tenemos que ejecutar los siguientes comandos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>wget https<span class="sc">:</span><span class="er">//</span>vastdb.crg.eu<span class="sc">/</span>libs<span class="sc">/</span>vastdb.hs2.<span class="dv">23</span>.<span class="dv">06</span>.<span class="fl">20.</span>tar.gz</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>wget https<span class="sc">:</span><span class="er">//</span>vastdb.crg.eu<span class="sc">/</span>libs<span class="sc">/</span>vastdb.mm2.<span class="dv">23</span>.<span class="dv">06</span>.<span class="fl">20.</span>tar.gz</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>wget https<span class="sc">:</span><span class="er">//</span>vastdb.crg.eu<span class="sc">/</span>libs<span class="sc">/</span>vastdb.rno.<span class="dv">23</span>.<span class="dv">06</span>.<span class="fl">20.</span>tar.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con esto hemos instalado las librerías para hacer el alineamiento en humano (última vesión del genoma), en ratón y en rata, respectivamente. Si necesitamos realizar alineamientos con otras especies hay que acceder el github de Vast-Tolols.</p>
<p>Una vez hemos instalado esto tenemos que añadir Vast-Tools al PATH para que se pueda ejecutar desde cualquier carpeta. Esto lo hacemos con la siguiente línea de comandos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>export PATH<span class="ot">=</span><span class="er">~/</span>directorio<span class="sc">/</span>donde<span class="sc">/</span>hayas<span class="sc">/</span>guardado<span class="sc">/</span>vast<span class="sc">-</span>tools<span class="sc">:</span><span class="er">$</span>PATH</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>echo <span class="st">'export PATH=~ directorio/donde/hayas/guardado/ vast-tools:$PATH'</span> <span class="sc">&gt;</span><span class="er">&gt;</span> <span class="er">~/</span>.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para comprobar que temenos <code>matt</code> instalado Podemos hacer la prueba de esctibir en el terminal el propio nombre:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Vast<span class="sc">-</span>tools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y el output que nos debe devolver es el siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>VAST<span class="sc">-</span>TOOLS v2.<span class="fl">5.1</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>Usage<span class="sc">:</span> vast<span class="sc">-</span>tools sub<span class="sc">-</span>commands [options]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>[sub<span class="sc">-</span>commands]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        align           <span class="sc">:</span>       Align RNA<span class="sc">-</span>Seq reads to exon<span class="sc">-</span>exon junctions and quantify AS</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        merge           <span class="sc">:</span>       Merge vast<span class="sc">-</span>tool outputs from multiple sub<span class="sc">-</span>samples</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        combine         <span class="sc">:</span>       Combine two or more <span class="st">'aligned'</span> RNA<span class="sc">-</span>Seq samples into summary tables.</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>..</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>Performance<span class="sc">:</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span>o<span class="sc">/--</span>offrate <span class="sc">&lt;</span>int<span class="sc">&gt;</span> override offrate of index; must be <span class="sc">&gt;=</span> index<span class="st">'s offrate</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="st">  -p/--threads &lt;int&gt; number of alignment threads to launch (default: 1)</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="st">  --mm               use memory-mapped I/O for index; many '</span>bowtie<span class="st">'s can share</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="st">  --shmem            use shared mem for index; many '</span>bowtie<span class="st">'s can share</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="st">Other:</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="st">  --seed &lt;int&gt;       seed for random number generator</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="st">  --verbose          verbose output (for debugging)</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="st">  --version          print version information and quit</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="st">  -h/--help          print this usage message</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>También tenemos que instalar una serie de paquetes para R con los siguientes comandos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>R <span class="sc">-</span>e <span class="st">'install.packages(c("optparse", "RColorBrewer", "reshape2", "ggplot2", "devtools"))'</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>R <span class="sc">-</span>e <span class="st">'devtools::install_github("kcha/psiplot")'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Continuamos trabajando en Terminal aunque sea con R</strong>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>La instalación de estos paquetes pueden necesitar de la actualización e instalación de otros, de manera que tendremos que ir comprobando cuales son necesarios y e instalarlos (buscando en internet como instalarlos). Tuve bastantes problemas con esto así que podéis encontrar la solución en el documento del terminal de este día. Una vez instalado vast-tools, es necesario comprobar que tenemos instalado una herramienta de alineamiento: <code>bowtie</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>Todo lo hecho a partir de aquí está en:</em></p>
<p><a href="./Terminales Guardados/Terminal_9-15-23.txt"><code>Terminal_9-15-23.txt</code></a></p>
</div>
</div>
</section>
<section id="instalación-de-bowtie" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="instalación-de-bowtie"><span class="header-section-number">2.2</span> Instalación de bowtie</h2>
<p>Para comprobar si la temenos, en debemos hacer la prueba de esctibir en el terminal una de sus funciones, como por ejemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>No index, query, or output file specified<span class="sc">!</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>Usage<span class="sc">:</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>bowtie [options]<span class="sc">*</span> <span class="er">&lt;</span>ebwt<span class="sc">&gt;</span> {<span class="sc">-</span><span class="dv">1</span> <span class="sc">&lt;</span>m1<span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">&lt;</span>m2<span class="sc">&gt;</span> <span class="er">|</span> <span class="sc">--</span><span class="dv">12</span> <span class="sc">&lt;</span>r<span class="sc">&gt;</span> <span class="er">|</span> <span class="sc">--</span>interleaved <span class="sc">&lt;</span>i<span class="sc">&gt;</span> <span class="er">|</span> <span class="er">&lt;</span>s<span class="sc">&gt;</span>} [<span class="sc">&lt;</span>hit<span class="sc">&gt;</span>]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>m1<span class="sc">&gt;</span>    Comma<span class="sc">-</span>separated list of files containing upstream <span class="fu">mates</span> (or the</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a> Performance<span class="sc">:</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span>o<span class="sc">/--</span>offrate <span class="sc">&lt;</span>int<span class="sc">&gt;</span> override offrate of index; must be <span class="sc">&gt;=</span> index<span class="st">'s offrate</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="st">  -p/--threads &lt;int&gt; number of alignment threads to launch (default: 1)</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="st">  --mm               use memory-mapped I/O for index; many '</span>bowtie<span class="st">'s can share</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="st">  --shmem            use shared mem for index; many '</span>bowtie<span class="st">'s can share</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="st">Other:</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="st">  --seed &lt;int&gt;       seed for random number generator</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="st">  --verbose          verbose output (for debugging)</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="st">  --version          print version information and quit</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="st">  -h/--help          print this usage message</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>También debemos comprobar la versión de que tenemos instalada (<strong>debe de ser la versión 1</strong>, tener cuidado porque también existe <code>bowtie2</code> y esa nos va a dar error). Para instalarlo tenemos que escribir los siguientes comandos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sudo apt<span class="sc">-</span>get update <span class="sc">-</span>y</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sudo apt<span class="sc">-</span>get install <span class="sc">-</span>y bowtie</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si está correctamente instalado todo pasamos al alineamiento con Vast-Tools.</p>
</section>
<section id="teoría-sobre-el-splicing-alternativo" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="teoría-sobre-el-splicing-alternativo"><span class="header-section-number">2.3</span> Teoría sobre el Splicing Alternativo</h2>
<p>El splicing alternativo genera múltiples ARNm diferentes y proteínas derivadas a partir de un único gen mediante la inclusión o exclusión de exones específicos. Este proceso ocurre en el 95% de los genes multiexónicos y está catalizado por el spliceosoma, un complejo formado por un núcleo de cinco pequeñas ribonucleoproteínas nucleares (U1, U2, U4, U5 y U6). El espliceosoma cuenta con la ayuda de más de 200 factores trans-actores que reconocen secuencias reguladoras cis dentro del pre-ARNm y dirigen el spliceosoma para incluir o excluir exones específicos. Así pues, las variantes de empalme pueden surgir de mecanismos que incluyen promotores alternativos, uso preferente de exones o sitios de splicing, alteración del orden de los exones y poliadenilación alternativa</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Images/Picture25.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Imagen 2</figcaption>
</figure>
</div>
<p>El splicing alternativo ofrece una importante ventaja evolutiva al proporcionar una gran fuente de diversidad proteómica. El splicing alternativo suele estar regulado a nivel tisular, y las variantes específicas de tejido cooperan para modular las redes de interacción proteína-proteína. Las células madre expresan variantes de empalme específicas en cada etapa de diferenciación, siendo las células madre indiferenciadas las que mantienen los niveles más altos de diversidad de isoformas de empalme. El empalme alternativo también es crítico en el desarrollo y puede responder a estímulos externos normales. Al igual que otras vías relacionadas con el desarrollo, el splicing alternativo puede ser regulado de forma aberrante por las células cancerosas para su beneficio. en beneficio propio. Los estudios del genoma completo revelan desde hace tiempo la existencia de patrones de splicing específicos del cáncer.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Extraído del siguiente artículo:</p>
<p>Chen, J., Weiss, W. Alternative splicing in cancer: implications for biology and therapy. Oncogene 34, 1–14 (2015). https://doi.org/10.1038/onc.2013.570</p>
</div>
</div>
</section>
<section id="alineamineto-para-splicing-alternativo-sa" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="alineamineto-para-splicing-alternativo-sa"><span class="header-section-number">2.4</span> Alineamineto para Splicing Alternativo (SA)</h2>
<section id="definiciones" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="definiciones"><span class="header-section-number">2.4.1</span> Definiciones</h3>
<p>En este paso, para aumentar la fracción de lecturas de unión de mapeo dentro de cada muestra de RNA-Seq, vast-tools divide automáticamente cada lectura en grupos de lectura de 50 nucleótidos (nt), utilizando por defecto una ventana deslizante de 25 nt (opción <code>--stepSize</code>). Por ejemplo, una lectura de 100 nt produciría 3 lecturas superpuestas (de las posiciones 1-50, 26-75 y 51-100). Además, se combinan las dos lecturas de la secuenciación por pares, si están disponibles. Para la cuantificación, sólo se considera un recuento aleatorio por grupo de lecturas (es decir, todas las sublecturas procedentes de la misma lectura original) para evitar el recuento múltiple de la misma molécula secuenciada original.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Es muy recomendable que los caracteres especiales (‘-’, ‘.’, etc.) no formen parte de los nombres de los archivos fastq, ya que pueden causar problemas imprevistos; utilice ’_’ en su lugar. (El uso de ‘-’ está reservado para proporcionar la longitud de lectura (legado) o especificar que las lecturas han sido sustraídas del genoma; ver más abajo).</p>
</div>
</div>
<p>Actualmente, vast-tools soporta múltiples especies y ensamblajes y está en constante crecimiento en coordinación con VastDB. A partir de la v2.4.0, la especie se proporciona utilizando el ensamblaje estándar (por ejemplo, hg38, mm9, etc).</p>
<p>Los eventos de splicing vendrán definidos como:</p>
<ul>
<li><p><strong>PSI</strong> (Percent Splice-In), que define los diferentes eventos de “Exon-Exon Junction”.</p></li>
<li><p><strong>PSU</strong> (Percent Splice-site usage), que define los eventos de “alternative splice sites”</p></li>
<li><p><strong>PIR</strong> PIR (Percent of Intron Retention), que define los eventos de “intrón retention”</p></li>
</ul>
<p>Estas medidas son porcentajes que dependen del número de veces que ha ocurrido un evento y se calcula como nº de veces que ocurre un evento en un gen con respecto al número de transcritos cuantificados:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Images/Picture26.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Imagen 3</figcaption>
</figure>
</div>
<p>Para habilitar el análisis de expresión génica, utilizar la opción “–expr“ (cálculos PSI/PSU/PIRs y cRPKM (lecturas corregidas por aplicabilidad por Kbp y millones de lecturas mapeadas)]o “–exprONLY” (solo cRPKMs). Los cRPKMs se obtienen mapeando solo los primeros 50 nucleótidos de cada lectura, o solo los primeros 50 nucleótidos de la lectura directa si se proporcionan lecturas de extremo pareado.</p>
<p>A continuación hay se muestra un esquema del funcionamiento y posibilidades de vast-tools:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Images/Picture27.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Imagen 4</figcaption>
</figure>
</div>
</section>
<section id="alineamiento" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="alineamiento"><span class="header-section-number">2.4.2</span> Alineamiento</h3>
<p>Como hemos repetido, para el alineamiento vamos a utilizar la herramienta Vast-Tools. Para ello vamos a la carpeta en la que tengamos los archivos a analizar (tras procesarlos en matt) y allí ejecutamos el comando <code>vast-tool align</code> (que lo explicaré con sus argumentos a continuación con la imgen 2):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>vast<span class="sc">-</span>tools align Luminal_1_1.fastq.gz Luminal_1_2.fastq.gz <span class="sc">-</span>sp Hs2 <span class="sc">-</span>o Vast<span class="sc">-</span>Tool_Align <span class="sc">--</span>expr <span class="sc">--</span>IR_version <span class="dv">2</span> <span class="sc">-</span>c <span class="dv">8</span> <span class="sc">-</span>n Luminal_1 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Images/Picture24.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Imagen 5</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Nota 1">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Este ejemplo es para cuando tenemos análisis Pair-end, de manera que tendremos un archivo (“Luminal_1_1.fastq.gz”) para la secuenciación 3’-&gt;5’ y otro (“Luminal_1_2.fastq.gz”) para la secuenciación 5’-&gt;3’. Si tuviéramos un análisis Single-end solo tendríamos que poner el único archivo que se nos hubiera descargado para esa muestra.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Nota 2">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cuidado de no excedernos en el argumento -c porque si vamos a lanzar varios procesos a la vez podemos colapsar el superordenador.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Nota 3">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>La expresión génica la calcula como corrected-RPKM values (cRPKM) (es decir, que la normaliza e función de la “effective length, la cual consiste en la media de la longitud de todos los transcritos de un gene poderada por la proporción de la expresión de cada transcrito.</p>
</div>
</div>
<p>Realmente el código que yo he corrido es el siguiente para añadir funciones (previamente explicadas):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>vast<span class="sc">-</span>tools align Luminal_1_1.fastq.gz Luminal_1_2.fastq.gz <span class="sc">-</span>sp Hs2top <span class="sc">-</span>o Vast<span class="sc">-</span>Tool_Align <span class="sc">--</span>expr <span class="sc">--</span>IR_version <span class="dv">2</span> <span class="sc">-</span>c <span class="dv">8</span> <span class="sc">-</span>n Luminal_1 <span class="dv">1</span><span class="sc">&gt;</span>Alineamiento_luminal_1.out <span class="sc">&amp;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con esto le añado al final el comando <code>1&gt;Alineamiento_luminal_1.out</code> para que me genere un archivo con los mensajes del terminal t así luego poder chequearlos y el comando <code>&amp;</code> para que lo ejecute en segundo plano y así poder seguir usando el terminal (si quisiera desvincularlo a mi sesión ahora podría utilizar <code>disown</code> y podría cerrar el terminal sin miedo a parar el proceso).</p>
</section>
</section>
<section id="creación-de-tabla-de-datos-conjunta" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="creación-de-tabla-de-datos-conjunta"><span class="header-section-number">2.5</span> Creación de tabla de datos conjunta</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>Todo lo hecho a partir de aquí está en:</em></p>
<p><a href="./Terminales Guardados/Terminal_9-18-23.txt"><code>Terminal_9-18-23.txt</code></a></p>
</div>
</div>
<p>En el paso anterior hemos generado los PSI para cada una de la muestras por lo que ahora tendremos que mergear esas tablas para crear una única tabla de trabajo</p>
<p>El siguiente paso es combinar en una tabla todos los eventos de cada muestra. Para ello usaremos el comando <code>vast-tools combine</code>. Para utilizar este comando tenemos que estar en la carpeta que contenga la carpeta donde se han generado los alineamientos (la generada tiene que contener la subcarpeta llamada <code>to_compare</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>vast<span class="sc">-</span>tools combine <span class="sc">-</span>sp Hs2 <span class="sc">-</span>o Vast<span class="sc">-</span>Tool_Aling –cores <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El comando combinará teniendo en cuenta la versión del genoma humano -hg38- (-sp Hs2). Con el argumento <code>-o &lt;directorio&gt;</code> indicamos la carpeta que contiene los archivos a analizar. Tiene que ser la carpeta previamente mencionada, la que contiene la subcarpeta llamada “to_compare” (que coincide con la que pusimos en el argumento <code>-o</code> en el comando del alineamiento (el paso anterior). Con el argumento <code>–cores &lt;nº_cores&gt;</code> indicamos el número de cores o CPUs del superordenador que queremos que se utilicen para este proceso (por defecto se utiliza 1, con 6 va bastante rápido y en 3-5 min está hecho).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para más opciones siempre podemos consultar la ayuda del comando con</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>vast<span class="sc">-</span>tools combine <span class="sc">-</span>h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Una vez que hemos corrido el código se genera un archivo llamado <code>INCLUCION_table.tab</code> (con especificaciones de nuestra muestra en el nombre) la cual la podemos extraer del servidos para leerla en <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Inclusion_table<span class="ot">&lt;-</span><span class="fu">read.delim</span>(<span class="st">"INCLUSION_LEVELS_FULL-hg38-6.tab"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(Inclusion_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture29.png" class="img-fluid"></p>
<p>Donde cada una de estas columnas nos da la siguiente información:</p>
<ul>
<li><p>Columna 1 (<strong>GENE</strong>). Official Gene Symbol</p></li>
<li><p>COlumna 2 (<strong>EVENT</strong>). ID del evento en VAST-DB compuesto por:</p>
<ul>
<li>Identificador de Especie: Hsa (human), Mmu (ratón), Gga (pollo)</li>
<li>Tipo de evento de splicing: alternative exon skipping (EX), retained intron (INT), alternative splice site donor choice (ALTD), or alternative splice site acceptor choice (ALTA). En el caso de ALTD/ALTA, cada uno de los sitions de spling está indicado (desde el interior del exon hacia afuera) sobre el total de número de sitios de splicing en el evento (e.g.&nbsp;HsaALTA0000011-1/2)</li>
<li>Identificador numérico</li>
</ul></li>
<li><p>Columna 3 (<strong>COORD</strong>). Coordenada en el genoma de la secuencia</p></li>
<li><p>Columna 4 (<strong>LENGHTH</strong>). Longitud de la secuencia, En evntos ALTF/ALTA el primer sitio de splicing para cada evento se asume como nucleótido 0.</p></li>
<li><p>Columna 5 (<strong>FullCO</strong>). Conjunto completo de coordenadas de la secuencia del evento de splicing alternativo.</p>
<ul>
<li>Para EX: chromosome:C1donor,Aexon,C2acceptor. Donde C1donor es el donante del exón “de referencia” aguas arriba, C2acceptor es el aceptor del exón “de referencia” aguas abajo y A es el exón alternativo. La cadena es “+” si C1donor &lt; C2acceptor. Si existen múltiples aceptores/donantes en cualquiera de los exones, se muestran separados por “+”. NOTA: Las coordenadas C1/C2 “de referencia” aguas arriba y aguas abajo no son necesariamente los exones C1/C2 aguas arriba y aguas abajo más cercanos, sino los más externos con suficiente soporte (para facilitar el diseño de cebadores, etc.). Si desea realizar análisis de las características de los exones y/o dibujar mapas de unión a ARN, se recomienda utilizar Matt.</li>
<li>Para ALTD: chromosome:Aexon,C2acceptor. Los múltiples donor del evento se separan con “+”.</li>
<li>Para ALTA: chromosome:C1donor,Aexon. Multiples acceptors del evento se separan con “+”.</li>
<li>Para INT: chromosome:C1exon=C2exon:strand.</li>
</ul></li>
<li><p>Columna 6 (<strong>COMPLEX</strong>): Tipo de evento:</p>
<ul>
<li>S, C1, C2, C3: Eventos de Exon-EXON Junction (EEJ) se cuantifican mediante splice site-based or transcript-based modules, con un incremento de los grados de complejidad (basado en Score 5 de un amplio panel de muestras de RNA-seq).</li>
<li>ANN: exon skipping (EX) events quantified by the ANNOTATION module. Their IDs also start by ≥ 6 (e.g.&nbsp;HsaEX6000001).</li>
<li>MIC: exon skipping (EX) que son microexones.</li>
<li>IR: eventos intron retention.</li>
<li>Alt3: eventos ALTA.</li>
<li>Alt5: eventos ALTD.</li>
</ul>
<p>A continuación, para cada muestra compilada hay una pareja de columnas que indican:</p></li>
<li><p>Columna 7 (<strong>Name_Sample</strong>): Porcentaje estimado de inclusión en la secuencia (PSI/PSU/PIR). PSI: percent spliced-in (para EEJ y EX). PSU: percent splice site usage (para ALTD y ALTA). PIR: percent intron retention (para INT).</p></li>
<li><p>Columna 8 (<strong>Name_Sample.Q</strong>): Puntuaciones de calidad y número de lecturas de inclusión y exclusión corregidas (qual@inc,exc):</p>
<ul>
<li><p>Score 1. Cobertura de lectura, basada en lecturas reales (como la utilizada en Irimia et al, Cell 2014). Esta es la única puntuación de cobertura utilizada por <code>compare</code>, <code>tidy</code> y <code>plot</code></p>
<ul>
<li>Para EX (excepto módulo microexón): OK/LOW/VLOW: (i) ≥20/15/10 lecturas reales (es decir, antes de la corrección de mapeabilidad) mapeadas a todas las uniones de empalme de exclusión, O (ii) ≥20/15/10 lecturas reales mapeadas a uno de los dos grupos de uniones de empalme de inclusión (aguas arriba o aguas abajo del exón alternativo), y ≥15/10/5 al otro grupo de uniones de empalme de inclusión.</li>
<li>Para EX (módulo de microexón): OK/LOW/VLOW: (i) ≥20/15/10 lecturas reales asignadas a la suma de uniones de empalme de exclusión, O (ii) ≥20/15/10 lecturas reales asignadas a la suma de uniones de empalme de inclusión.</li>
<li>Para INT: OK/LOW/VLOW: (i) ≥20/15/10 lecturas reales mapeadas a la suma de uniones de empalme de exclusión, O (ii) ≥20/15/10 lecturas reales mapeadas a una de las dos uniones de inclusión exón-intrón (el 5’ o 3’ del intrón), y ≥15/10/5 a las otras uniones de empalme de inclusión.</li>
<li>Para ALTD y ALTA: OK/LOW/VLOW: (i) ≥40/25/15 lecturas reales mapeadas a la suma de todas las uniones de empalme implicadas en el evento específico.</li>
<li>Para cualquier tipo de evento: SOK: los mismos umbrales que OK, pero un número total de lecturas ≥100.</li>
<li>Para cualquier tipo de evento: N: no alcanza el umbral mínimo (VLOW).</li>
</ul></li>
<li><p>Score 2. Read coverage, based on corrected reads (similar values as per Score 1).</p></li>
<li><p>Score 3.Esta puntuación se ha reciclado para contener información diferente de la versión v2.2.2:</p>
<ul>
<li>EX (excepto módulo microexón): recuentos de lecturas totales en bruto que admiten inclusión aguas arriba, inclusión aguas abajo y omisión (formato INC1=INC2=EXC).</li>
<li>EX (módulo de microexones): recuentos de lecturas totales sin procesar que admiten inclusión y exclusión (formato INC=EXC).</li>
<li>ALTD y ALTA: valor tipo PSI del exón que alberga el evento ALTD/ALTA. Esta puntuación se utiliza para filtrar eventos en <code>compare</code> basándose en la opción <code>--min_ALT_use</code>.</li>
<li>IR (a partir de v2.1.3): número corregido de lecturas del cuerpo del intrón (en una muestra de 200 pb en la mitad del intrón, o de todo el intrón si es más corto), y el número de posiciones mapeables en esa muestra (máximo 151 posiciones) (formato READS=POSICIONES).</li>
<li>Antes de la v2.1.3: Cobertura de lectura, basada en lecturas no corregidas que corresponden únicamente a las uniones de empalme C1A, AC2 o C1C2 de referencia (valores similares a los de la puntuación 1).</li>
</ul></li>
<li><p>Score 4. Esta puntuación tiene un significado diferente según el tipo de evento AS:</p>
<ul>
<li>EX (excepto para el módulo microexon): Desequilibrio de lecturas asignadas a las uniones de empalme de inclusión.
<ul>
<li>OK: la relación entre el número total de lecturas corregidas que apoyan la inclusión de uniones de empalme aguas arriba y aguas abajo del exón alternativo es &lt; 2.</li>
<li>B1: la relación entre el número total de lecturas corregidas que apoyan la inclusión de los empalmes de empalme aguas arriba y aguas abajo del exón alternativo es &gt; 2 pero &lt; 5.</li>
<li>B2: la relación entre el número total de lecturas corregidas que apoyan la inclusión de empalmes de empalme aguas arriba y aguas abajo del exón alternativo es &gt; 5 (pero ninguna es 0).</li>
<li>B3: cuando las lecturas corregidas para la inclusión de un lado son al menos 15 y 0 para el otro. Se utiliza para filtrar eventos en <code>compare</code> cuando la opción <code>--noB3</code> está activada.</li>
<li>Bl/Bn: baja (entre 10 y 14)/ninguna cobertura de lectura (entre 1 y 9) para las uniones de empalme que apoyan la inclusión.</li>
</ul></li>
<li>EX (módulo de microexones): “na” (no se proporciona información).</li>
<li>ALTD y ALTA: recuentos de lecturas brutas para el sitio de empalme específico, para todos los sitios de empalme del evento juntos (=lecturas totales) y para los que admiten la omisión del exón anfitrión. En versiones anteriores a la v2.2.2: lecturas totales del evento para todas las combinaciones o sólo para el aceptor de referencia (para ALTD) o donante (para ALTA).</li>
<li>IR: recuentos de lecturas brutas que corresponden a la unión exón-intrón aguas arriba, intrón-exón aguas abajo y exón-exón en el formato EIJ=IEJ=EEJ). En versiones anteriores a la v2.2.2, se mostraban los recuentos corregidos en lugar de los recuentos de lecturas en bruto.</li>
</ul></li>
<li><p>Score 5.Esta puntuación tiene un significado diferente según el tipo de evento:</p>
<ul>
<li>EX (excepto para el módulo microexon): Complejidad del evento. La puntuación se refiere al número de lecturas que proceden de las uniones “de referencia” C1A, AC2 y C1C2. La complejidad aumenta a medida que: S &lt; C1 &lt; C2 &lt; C3.
<ul>
<li>S: el porcentaje de lecturas complejas (es decir, las lecturas de inclusión y exclusión que no corresponden a las uniones de empalme C1A, AC2 o C1C2 de referencia) es &lt; 5%.</li>
<li>C1: el porcentaje de lecturas complejas es &gt; 5% pero &lt; 20%.</li>
<li>C2: el porcentaje de lecturas complejas es &gt; 20% pero &lt; 50%.</li>
<li>C3: el porcentaje de lecturas complejas es &gt; 50%.</li>
<li>NA: evento de baja cobertura.</li>
</ul></li>
<li>EX (módulo de microexones): “na” (no se proporciona información).</li>
<li>ALTD y ALTA: puntuación de complejidad similar a la de los exones. En este caso, un determinado donante (para ALTA) o aceptor (para ALTD) se considera el sitio “de referencia”, y las lecturas complejas son las procedentes de cualquier otro donante/aceptor.</li>
<li>IR: valor p de una prueba binomial de equilibrio entre las lecturas asignadas a las uniones exón-intrón aguas arriba y aguas abajo, modificado por las lecturas asignadas a una ventana de 200 pb en el centro del intrón (véase Braunschweig et al., 2014).</li>
</ul></li>
<li><p>inc,exc. número total de lecturas, corregido para la mapeabilidad, que admiten inclusión y exclusión, de forma que PSI = inc/(inc+exc). Así, cuando las lecturas de inclusión implican conjuntos de uniones aguas arriba y aguas abajo, inc y exc se escalan.</p></li>
</ul>
<p>Pero nos podemos quedar con el primer score como referencia.</p></li>
</ul>
</section>
<section id="comparación-entre-grupos-análisis-de-splicing-diferencial" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="comparación-entre-grupos-análisis-de-splicing-diferencial"><span class="header-section-number">2.6</span> Comparación entre grupos (Análisis de Splicing diferencial)</h2>
<section id="definiciones-1" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="definiciones-1"><span class="header-section-number">2.6.1</span> Definiciones</h3>
<p>Vast-tools genera comparaciones entre grupos principalmente mediante la comparación de las medias de sus respectivos percent inclusión levels del evento (PSI, PSU o PIR, dependiendo del evento). Un detalle importante es que a partir de ahora vamos a referirnos a todos los inclusión levels como PSI independientemente del evento que sea, aunque si quieres ser purista, para las gráficas deberías de poner el percent inclusión level correspondiente</p>
<div class="callout-attention">
<p>Recordamos que PSI es para Exon-Exon Juction (EEJ, que incluye todos los tipos de exón skipping), el PSU hace referencia a los Alternative Splice Aites (5’ y 3’) y el PIR hace referencia a los eventos de Intron retention</p>
</div>
<p>Para eventos AS válidos, <code>vast-tools compare</code> requiere que el valor absoluto de ΔPSI sea superior a un umbral proporcionado como <code>--min_dPSI</code>. Además, requiere que la distribución PSI de los dos grupos no se superponga. Esto puede modificarse con la opción <code>--min_range</code>, para proporcionar un mayor o menor rigor. A mayor diferencia mayor rigor. Estos valores los vemos definidos en la siguiente imagen:</p>
<p><img src="./Images/Picture28.png" class="img-fluid" alt="Imagen 5"> También es posible imprimir otros conjuntos de eventos AS de especial interés para comparaciones de características (por ejemplo, utilizando Matt). Esto puede hacerse utilizando la opción <code>--print_sets</code>. Producirá tres conjuntos de eventos AS:</p>
<ol type="1">
<li><p>Eventos constitutivos (CS), que corresponden a aquellos con PSI &lt; 5 (para IR) o PSI &gt; 95 (para todos los demás tipos) en todas las muestras comparadas;</p></li>
<li><p>Eventos crípticos (CR), que corresponden a aquellos con PSI &gt; 95 (para IR) o PSI &lt; 5 (para todos los demás tipos) en todas las muestras comparadas;</p></li>
<li><p>Eventos AS no cambiantes (AS_NC), que corresponden a aquellos con 10 &lt; av_PSI &lt; 90 en al menos uno de los grupos (o un rango de PSI &gt; 10) y que no cambian entre las dos condiciones. Esto último se especifica con la opción <code>--max_dPSI</code>. Por defecto, se toma 1/5 del <code>--min_dPSI</code> proporcionado.</p></li>
</ol>
<p>Esto último hay que tenerlo en cuenta si vamos a descargar los datos (la “inclusion table” que generamos en el paso anterior). Los eventos de splicing constitutivos son aquellos que van se van a dar siempre por lo cual, su PSI va a ser de 100, mientras que los que no se dan nunca van a tener un valor de PSI de 0. Esto se conoce como eventos de tipo “switch” (ON/OFF). El resto son más fluctuantes y son a los que les podemos evaluar verdaderamente un Splicing Diferencial. Es por ello por lo que al comenzar el procedimiento si lo hacemos en R tenemos que establecer filtros como veremos posteriormente.</p>
</section>
<section id="procedimiento-en-terminal" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="procedimiento-en-terminal"><span class="header-section-number">2.6.2</span> Procedimiento en terminal</h3>
<p>Para la comparación entre grupos y las consecutivas gráficas tendremos que instalar-actualizar bastantes paquetes de R que se nos habrá indicado en el output del proceso anterior. Instalarlos todos antes de continuar. Una vez instalados todos los paquetes que necesitaremos procedemos al proceso de comparación con el comando “vast-tools compare”, el cual lo tenemos que ejecutar en la carpeta en la que hemos generado la combinación (en nuestro caso, y siguiendo con el ejemplo, tendremos que acceder a la carpeta <code>Vast-Tool_Aling</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>vast<span class="sc">-</span>tools compare INCLUSION_LEVELS_FULL<span class="sc">-</span>hg38<span class="fl">-6.</span>tab <span class="sc">-</span>a Basal_1,Basal_2,Basal_3 <span class="sc">-</span>name_A Basal_Cells </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>b Luminal_1,Luminal_2,Luminal_3 <span class="sc">-</span>name_B Luminal_Cells <span class="sc">-</span>sp Hs2 <span class="sc">--</span>print_dPSI </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>GO <span class="sc">--</span>print_sets <span class="sc">--</span>min_dPSI <span class="dv">25</span> <span class="sc">--</span>min_range <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Los argumentos utilizados definen lo siguiente:</p>
<ul>
<li><p><code>INCLUSION_LEVELS_FULL-especie_y_version que hayamos utilizado-nº_muestras_procesadas.tab</code>, Este primer argumento se utiliza para indicar dónde se encuentran los datos. Estos datos se encuentran en un archivo que se ha generado con la función <code>to_compare</code> previamente en la carpeta que habíamos indicado, por eso teníamos que acceder a dicha carpeta (en nuestro caso <code>Vast-Tool_Aling</code>)</p></li>
<li><p><code>-a muestra_1,muestra_2,muestra_3</code>, en este argumento tenemos que añadir todas las muestras que pertenezcan a este grupo, separadas por comas y sin espacios.</p></li>
<li><p><code>-name_A Nombre_Grupo_A</code>, Nombre que le queremos dar al grupo de muestras incluidas en el grupo “a”.</p></li>
<li><p><code>-b muestra_1,muestra_2,muestra_3</code>, en este argumento tenemos que añadir todas las muestras que pertenezcan a este grupo, separadas por comas y sin espacios.</p></li>
<li><p><code>-name_B Nombre_Grupo_B</code>, Nombre que le queremos dar al grupo de muestras incluidas en el grupo “b”.</p></li>
<li><p><code>-Hs2</code></p></li>
<li><p><code>--print_dPSI</code>, ya lo he mos visto previamente</p></li>
<li><p><code>--GO</code>, ya lo hemos visto previamente</p></li>
<li><p><code>--print_sets</code>, ya lo hemos visto previamente</p></li>
<li><p><code>--min_dPSI</code>, ya lo hemos visto previamente</p></li>
<li><p><code>--min_range</code>, ya lo hemos visto previamente</p></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>A partir de ahora, lo que vamos a ver es trabajando en R pero siguiendo el flujo de trabajo del <a href="https://doi.org/10.1007/978-1-0716-2521-7_7">capítulo de libro de Vast-tools</a> (citado al principio de esta guía). Los resultados trabajando en termial (que lo iré haciendo de forma paralela) se mostrarán en:</p>
<p><a href="./Terminales Guardados/Terminal_VT.txt"><code>Terminal_VT.txt</code></a></p>
</div>
</div>
</section>
<section id="procedimiento-en-r" class="level3" data-number="2.6.3">
<h3 data-number="2.6.3" class="anchored" data-anchor-id="procedimiento-en-r"><span class="header-section-number">2.6.3</span> Procedimiento en R</h3>
<p>Paquetes necesarios:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"DT"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"pheatmap"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"RColorBrewer"</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">"PCAtools"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggrepel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PCAtools)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="handmade-analysis" class="level4" data-number="2.6.3.1">
<h4 data-number="2.6.3.1" class="anchored" data-anchor-id="handmade-analysis"><span class="header-section-number">2.6.3.1</span> Handmade analysis</h4>
<p>Hemos de tener en cuenta dos cosas principales para realizar un prefiltrado de los datos generados con <code>vast-tool combine</code>:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Esta parte del proceso la voy hacer en R pero en el terminal porque los archivos pesan mucho y tardan en descargarse. Mostraré los códigos que he seguido matizando al inicio de los mismos que se ha hecho en R (de la siguiente manera: <code>#Hecho en R de terminal</code>)</p>
</div>
</div>
<p>Comenzamos leyendo la tabla INCLUSION_table.tab que hemos generado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hecho en R de terminal</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Inclusion_table<span class="ot">&lt;-</span><span class="fu">read.delim</span>(<span class="st">"INCLUSION_LEVELS_FULL-hg38-6.tab"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><strong>Eliminar las muestras de poca calidad</strong>. Las muestras con calidad “N” deben ser eliminadas (o no consideradas para crear la media del grupo para ese evento). El considerar los VLOW queda más a nuestra decisión.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para eso, el Dr.&nbsp;Luis Pedro Íñiguez (CRG) me ha proveeido de las siguientes funciones que había que definirlas antes de hacer este paso si no las tenemos defininas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hecho en R de terminal</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#remove Ns and VLOW from vast-tools INCLUCION TABLE</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>removeNVLOW <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  scores <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">".Q"</span>,<span class="fu">names</span>(x),<span class="at">fixed =</span> T)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  score2 <span class="ot">&lt;-</span> scores <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> score2){x[,i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^N|^VLOW"</span>,x[,i<span class="sc">+</span><span class="dv">1</span>]),<span class="cn">NA</span>,x[,i])}</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">#remove Ns from vast-tools INCLUSION TABLE</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>removeNonly <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  scores <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">".Q"</span>,<span class="fu">names</span>(x),<span class="at">fixed =</span> T)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  score2 <span class="ot">&lt;-</span> scores <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> score2){</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    x[,i] <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^N"</span>,x[,i<span class="sc">+</span><span class="dv">1</span>]),<span class="cn">NA</span>,x[,i])</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Aplicado a nuestra INCLUSION_Table de manera muy restrictiva sería de la siguiente manera:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hecho en R de terminal</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>rmdf<span class="ot">&lt;-</span><span class="fu">removeNonly</span>(df)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Para ser menos restrictivos usaríamos</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#rmdf&lt;-removeNVLOW(Inclusion_table)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez hemos hecho el filtro de calidad tenemos que hacer la media de los componentes de cada grupo.</p>
<ol start="2" type="1">
<li><strong>Establecer los thresolds</strong>.</li>
</ol>
<ol type="a">
<li><em>Difrencia entre las medias</em>. Tenemos que buscar lo mismo que se busca con la varibale <code>--min_dPSI</code>en <code>vast-tool combine</code>.</li>
<li><em>Diferencia mínima entre el menor valor de la que tenga media más alta y mayor valor de la que tenga la media más baja</em>. Tenemos que buscar lo mismo que se busca con la varibale <code>--min_range</code> en <code>vast-tool combine</code>.</li>
<li><em>Eliminar eventos constitutivos</em>. Como explicamos previamente, hay eventos de tipo “switch”. Según este parámetro deben ser excluidos aquellos eventos que en un grupo tenga un PSI&gt;90 y en el otro tengan un PSI&lt;10 (voy a considerar aquellos que NO pasan este threshold aquellos eventos que en uno de los grupos cumpla la condición de 10&lt;PSI&lt;90 pero en el otro no).</li>
</ol>
<p>Para todo este apartado 2 he desarrollado un código que para usarlo tenemos que definir nuestros grupos muestrales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hecho en R de terminal</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Group_1<span class="ot">&lt;-</span><span class="st">"Basal"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>Samples_1<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Basal_1"</span>, <span class="st">"Basal_2"</span>, <span class="st">"Basal_3"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>Group_2<span class="ot">&lt;-</span><span class="st">"Luminal"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>Samples_2<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Luminal_1"</span>, <span class="st">"Luminal_2"</span>, <span class="st">"Luminal_3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>También tenemos que definir los thresholds que vamos a poner (a, b, c):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hecho en R de terminal</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#thresholds para la diferencia entre grupos</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>min_range<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>min_dPSI<span class="ot">=</span><span class="dv">25</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Valores de PSI/PSU/PIR a considerar splicing constitutivo</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>Const_max<span class="ot">=</span><span class="dv">90</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>Const_min<span class="ot">=</span><span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y ya comienza el código (que postermiomente desglorasaré para explicarlo):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hecho en R de terminal</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>dPSI_table<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>,  <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dPSI_table)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>, <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>) <span class="co">#definimos el nombre de las columnas</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Y también creamos la tabla en la que se van a pasar aquellos que pasen el threshold</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>dPSI_PASS<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>,  <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dPSI_PASS)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>,  <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>) <span class="co">#definimos el nombre de las columnas</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Por último creamos otra para aquellos que pasen el threshold y cumplan la condición de que 10&gt;PSI&gt;90</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>dPSI_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>,  <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dPSI_df)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>,  <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>) <span class="co">#definimos el nombre de las columnas</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Establecemos los valores mínimos para la definición de las filas</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>fila_PASS<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>fila_df<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>porcentaje<span class="ot">=</span><span class="fl">0.02</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>Hora_inicio<span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rmdf))){</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="do">##### guardar variables a mantener #########</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>dPSI_table[i, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) ]<span class="ot">&lt;-</span>rmdf[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>dPSI_table[i, <span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>) ]<span class="ot">&lt;-</span>rmdf[i,<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="do">#######################</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="do">##### Medias  #########</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>Group_1_mean<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(rmdf[i, Samples_1]) <span class="sc">%&gt;%</span> <span class="fu">mean</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(, <span class="at">digits=</span><span class="dv">5</span>)</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>Group_2_mean<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(rmdf[i, Samples_2]) <span class="sc">%&gt;%</span> <span class="fu">mean</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(, <span class="at">digits=</span><span class="dv">5</span>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>dPSI_table[i, <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>) ]<span class="ot">&lt;-</span><span class="fu">c</span>(Group_1_mean, Group_2_mean)</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="do">##### dPSI #########</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>Diff<span class="ot">&lt;-</span>Group_2_mean <span class="sc">-</span> Group_1_mean</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a><span class="co">#y ahora hacemos que salga FALSE para aquellos valores que sean inferior al rango mínimo establecido</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>Diff_threshold<span class="ot">&lt;-</span><span class="fu">ifelse</span>(<span class="fu">abs</span>(Diff)<span class="sc">&gt;</span>min_dPSI, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="do">##### Overlaping #########</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>Rang<span class="ot">&lt;-</span><span class="fu">ifelse</span>(Diff<span class="sc">&gt;</span><span class="dv">0</span>, <span class="fu">min</span>(Group_2_mean)<span class="sc">-</span><span class="fu">max</span>(Group_1_mean), <span class="fu">min</span>(Group_1_mean)<span class="sc">-</span><span class="fu">max</span>(Group_2_mean))</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a><span class="co">#y vemos si pasa el threshold</span></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>Rang_threshold<span class="ot">&lt;-</span><span class="fu">ifelse</span>(Diff<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">min</span>(Group_2_mean)<span class="sc">-</span><span class="fu">max</span>(Group_1_mean)<span class="sc">&gt;</span>min_range <span class="sc">|</span> Diff<span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">min</span>(Group_1_mean)<span class="sc">-</span><span class="fu">max</span>(Group_2_mean)<span class="sc">&gt;</span>min_range, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="do">##### Paso del threshold #########</span></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>PASS<span class="ot">&lt;-</span><span class="fu">ifelse</span>(Rang_threshold <span class="sc">&amp;</span> Diff_threshold, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a><span class="co">#En la columna threshold añadimos si se cumplen los cutoffs que hemos establecido</span></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>dPSI_table[i, <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>)]<span class="ot">&lt;-</span><span class="fu">c</span>(Diff ,Rang, PASS)</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="do">#####                        #########</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="do">#####   tabla de thresholds  #########</span></span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="do">#####                        #########</span></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="co">#Ahora solo eventos que han pasado el threshold se van a pasar a una nueva tabla con la que tabajaremos para representar los eventos desregulados</span></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(PASS) <span class="sc">&amp;</span> PASS<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a>dPSI_PASS[fila_PASS,]<span class="ot">&lt;-</span>dPSI_table[i,]</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="co">#Una vez hemos acabado la línea</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a>fila_PASS<span class="ot">=</span>fila_PASS<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a><span class="do">#####                        #########</span></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="do">#####   tabla de thresholds  #########</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="do">#####     + 10&lt;PSI&lt;90        #########</span></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a><span class="co">#Ahora  nuevo df en el que se acumularán solo eventos que han pasado el threshold</span></span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a><span class="co">#y hacemos el bucle</span></span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(PASS) <span class="sc">&amp;</span> PASS<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> </span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a>   ((Group_1_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_2_mean<span class="sc">&gt;</span>Const_min) <span class="sc">|</span>  </span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>    (Group_2_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_1_mean<span class="sc">&gt;</span>Const_min) <span class="sc">|</span></span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a>    (Group_1_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_2_mean<span class="sc">&gt;</span>Const_max) <span class="sc">|</span>  </span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a>    (Group_2_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_1_mean<span class="sc">&gt;</span>Const_max) <span class="sc">|</span> </span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a>    (Group_1_mean<span class="sc">&lt;</span>Const_min <span class="sc">&amp;</span> Group_2_mean<span class="sc">&gt;</span>Const_min) <span class="sc">|</span> </span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a>    (Group_2_mean<span class="sc">&lt;</span>Const_min <span class="sc">&amp;</span> Group_1_mean<span class="sc">&gt;</span>Const_min))){</span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a>dPSI_df[fila_df,]<span class="ot">&lt;-</span>dPSI_table[i,]</span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a><span class="co">#Una vez hemos acabado la línea</span></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a>fila_df<span class="ot">=</span>fila_df<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a><span class="co">#Se imprime el porcentaje de procesado y la hora</span></span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="fu">round</span>(<span class="fu">nrow</span>(rmdf)<span class="sc">*</span>porcentaje)){</span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a>  Hora_porcentaje<span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a>  diferencia_segundos <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(Hora_porcentaje, Hora_inicio, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a>  tiempo_restante_segundos <span class="ot">&lt;-</span> diferencia_segundos <span class="sc">/</span> (porcentaje) </span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>  tiempo_restante_minutos <span class="ot">&lt;-</span> tiempo_restante_segundos <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a>  tiempo_restante_horas <span class="ot">&lt;-</span> tiempo_restante_minutos <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(porcentaje<span class="sc">*</span><span class="dv">100</span>, <span class="st">"% (hora:"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%X, %d/%b/%Y) ---  Tiempo restante estimado: "</span>), <span class="fu">round</span>(tiempo_restante_horas), <span class="st">"h "</span>, <span class="fu">round</span>(tiempo_restante_minutos <span class="sc">-</span> <span class="fu">round</span>(tiempo_restante_horas)<span class="sc">*</span><span class="dv">60</span>), <span class="st">"min"</span>))</span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a>  porcentaje<span class="ot">&lt;-</span>porcentaje<span class="fl">+0.02</span></span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(porcentaje<span class="sc">&gt;</span><span class="fl">0.9999999999999999999999999999999999999</span>){ </span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a>         <span class="fu">print</span>(<span class="st">"-------------------------------   Proceso finalizado   --------------------------------------"</span>)</span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Expliación del código">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expliación del código
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Comenzamos definiendo las tablas que se van a generar y las filas en las que se van a ir incorporando los resultados:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>dPSI_table<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>, <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dPSI_table)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>, <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Y también creamos la tabla en la que se van a pasar aquellos que pasen el threshold</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>dPSI_PASS<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>, <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dPSI_df)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>, <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Por último creamos otra para aquellos que pasen el threshold y cumplan la condición de que 10&gt;PSI&gt;90</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>dPSI_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>, <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dPSI_df)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Group_1, Group_2, <span class="st">"dPSI"</span>, <span class="st">"range"</span>, <span class="st">"Pass_threshold"</span>, <span class="st">"COORD"</span>, <span class="st">"LENGTH"</span>, <span class="st">"FullCO"</span>, <span class="st">"COMPLEX"</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Establecemos los valores mínimos para la definición de las filas</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>fila_PASS<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>fila_df<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>porcentaje<span class="ot">=</span><span class="fl">0.02</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co">#guardamos la hora de inicio del proceso para finalmente estimar el tiempo que falta de proceso (ver paso 11)</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>Hora_inicio<span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Generación de tablas">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Generación de tablas
</div>
</div>
<div class="callout-body-container callout-body">
<p>En este caso vamos a generar varias tablas para comparar los resultado y tener la opción de verlo todo porque estamos practicando, si fueramos a trabaja sabiendo lo que queremos tendríamos que modificar este código para hacerlo más eficiente y que solo genere la tabla que nos interesa</p>
</div>
</div>
<p>A continuación creamos un bucle para ir aplicando el procedimiento siguiente a cada una de las filas de <code>rmdf</code>.</p>
<ol start="2" type="1">
<li>Pasamos los valores que nos interesa mantener al new dataframe <code>dPSI_table</code> que se utilizará como base para todas las operaciones</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dPSI_table[fila, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) ]<span class="ot">&lt;-</span>rmdf[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>dPSI_table[fila, <span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>) ]<span class="ot">&lt;-</span>rmdf[i,<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Calculamos la media de los dos grupos y las guardamos en las columnas corresponientes.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>Group_1_mean<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(rmdf[fila, Samples_1]) <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>Group_2_mean<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(rmdf[fila, Samples_2]) <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>dPSI_table[fila, <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>) ]<span class="ot">&lt;-</span><span class="fu">c</span>(Group_1_mean, Group_2_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Calculamos la diferencia (equivalente a <code>min_dPSI</code>) entre las medias de los grupos y establecemos si pasa o no pasa el threshold:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#La diferencia es simplemente la resta de las medias</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>Diff<span class="ot">&lt;-</span>Group_2_mean <span class="sc">-</span> Group_1_mean</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#y ahora hacemos que salga FALSE para aquellos valores que sean inferior al rango mínimo establecido</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>Diff_threshold<span class="ot">&lt;-</span><span class="fu">ifelse</span>(<span class="fu">abs</span>(Diff)<span class="sc">&gt;</span>min_dPSI, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>Para el rango (equivalente a <code>min_range</code>) primero definimos que que el rango mínimo se calcula como el valor mínimo del grupo con mayor expresión y el valor máximo del grupo con menor expresión:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>Rang<span class="ot">&lt;-</span><span class="fu">ifelse</span>(Diff<span class="sc">&gt;</span><span class="dv">0</span>, <span class="fu">min</span>(Group_2_mean)<span class="sc">-</span><span class="fu">max</span>(Group_1_mean), <span class="fu">min</span>(Group_1_mean)<span class="sc">-</span><span class="fu">max</span>(Group_2_mean))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#y vemos si pasa el threshold</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>Rang_threshold<span class="ot">&lt;-</span><span class="fu">ifelse</span>(Diff<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">min</span>(Group_2_mean)<span class="sc">-</span><span class="fu">max</span>(Group_1_mean)<span class="sc">&gt;</span>min_range <span class="sc">|</span> Diff<span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">min</span>(Group_1_mean)<span class="sc">-</span><span class="fu">max</span>(Group_2_mean)<span class="sc">&gt;</span>min_range, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="6" type="1">
<li>Damos valor a la columna de <code>Pass_threshold</code> en función de si se pasan ambos thresholds. Si ambos threshold pasan se define como 1 y alguno o uno de ellos no pasan se definen como 0):</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>PASS<span class="ot">&lt;-</span><span class="fu">ifelse</span>(Rang_threshold <span class="sc">&amp;</span> Diff_threshold, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#En la columna threshold añadimos si se cumplen los cutoffs que hemos establecido</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>dPSI_table[fila, <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>)]<span class="ot">&lt;-</span><span class="fu">c</span>(Diff ,Rang, PASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Estadística para Splicing">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Estadística para Splicing
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Tras una interesante conversación con el Dr.&nbsp;Manuel Irimia he comprendido que realizar un test estadístico para 3 muestras (aunque se haga un no paramétrico) no tiene sentido porque el pvalor va a dar como poco 0.05 de manera que él, en Vast-Tools, no realiza estadística sino que se basa en los thresholds (de diferencia mínima de las medias y que no exista overlapping entre la distribución de las muestras) así que podríamos dejarlo aquí. Esto se debe al tipo de distribución que presentan los splicing (llamada distribución beta), como podemos ver en las siguientes imágenes:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Images/Picture30.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Imagen obtenida de <a href="https://compbio.imm.medicina.ulisboa.pt/app/betAS">betAS</a></figcaption>
</figure>
</div>
<p>Sin embargo, es posible que queramos realizar algún tipo de aproximación estadística de manera que si tenemos 3 muestras, una vez el Dr.&nbsp;Irima (mirar el ejemplo al final del párrafo) realizó un test de wilkinson + un Test de Student (o algo similar) de manera que si ambos estaban por debajo de 0.05 podemos justificar en la sección de materiales y métodos que estamos haciendo ambos test y cuando consideramos significativa una diferencia (que ambos test pasen). Según un físico muy reputado, Dr.&nbsp;Nuno L Barbosa-Morais, con el que ha colaborado en muchas ocasiones, un test estadístico es adecuado si lo justificas de forma adecuada (tiene que tener sentido, claro). Un ejemplo de esto que os comento ocurre en la estadística del artículo “<a href="https://pubmed.ncbi.nlm.nih.gov/23739326/">Hong Han et al.&nbsp;(2013). Nature</a>”, en la Figura-4G.</p>
<p>Debido al tipo de distribución del splicing alternativo, el tipo de test estadístico tiene que basarse en la propia distribución beta. Por eso, lo más recomendabe es utilizar el paquete de R <a href="https://www.biorxiv.org/content/10.1101/2022.12.26.521935v1"><code>betAS</code></a> (de Dr.&nbsp;Nuno L Barbosa-Morais) en el cual se estiman pval de las diferencias en el splicing entre dos grupos muestrales (aunque sean pequeños).</p>
<p>A modo de curiosidad, también hemos debatido sobre cuándo utilizar el pvalor ajustado, si antes o después de utilizar el filtro (porque el valor del pval ajustado depende directamente del número de eventos a los que le has calculado el pval). Su opinión es que, para ser más restrictivo se puede utilizar después de aplicar el threshold.</p>
<p>Posteriormente utilizaremos <code>betAS</code> para calcular el pvalor estadístico de nuestros eventos</p>
</div>
</div>
</div>
<ol start="7" type="1">
<li>Solo eventos que han pasado el threshold a y b (por comprobar los datos que se generan y poder explorar los constitutivos que se comportan como tal) se van a pasar a una nueva tabla <code>dPSI_PASS</code> (<em>se podría haber puesto antes porque no considera los pvalores calculados, pero primero quería hacer los cálculos y finalmente definir las tablas</em>):</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(PASS) <span class="sc">&amp;</span> PASS<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>dPSI_PASS[fila_PASS,]<span class="ot">&lt;-</span>dPSI_table[i,]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Una vez hemos acabado la línea</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>fila_PASS<span class="ot">=</span>fila_PASS<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="8" type="1">
<li>Solo eventos que han pasado el threshold a, b y c (por comprobar los datos que se generan y poder explorar los constitutivos que se comportan como tal) se van a pasar a una nueva tabla <code>dPSI_df</code> (<em>se podría haber puesto antes porque no considera los pvalores calculados, pero primero quería hacer los cálculos y finalmente definir las tablas</em>):</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(PASS) <span class="sc">&amp;</span> PASS<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>   ((Group_1_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_2_mean<span class="sc">&gt;</span>Const_min) <span class="sc">|</span>  </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    (Group_2_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_1_mean<span class="sc">&gt;</span>Const_min) <span class="sc">|</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    (Group_1_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_2_mean<span class="sc">&gt;</span>Const_max) <span class="sc">|</span>  </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    (Group_2_mean<span class="sc">&lt;</span>Const_max <span class="sc">&amp;</span> Group_1_mean<span class="sc">&gt;</span>Const_max) <span class="sc">|</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    (Group_1_mean<span class="sc">&lt;</span>Const_min <span class="sc">&amp;</span> Group_2_mean<span class="sc">&gt;</span>Const_min) <span class="sc">|</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    (Group_2_mean<span class="sc">&lt;</span>Const_min <span class="sc">&amp;</span> Group_1_mean<span class="sc">&gt;</span>Const_min))){</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>dPSI_df[fila_df,]<span class="ot">&lt;-</span>dPSI_table[i,]</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Una vez hemos acabado la línea</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>fila_df<span class="ot">=</span>fila_df<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="9" type="1">
<li>Al final de cada bucle, se calculará el porcentaje de proceso que llevamos realizado en función del nº de filas que se han procesado con respecto a las totales y en función del tiempo que llevamos de proceso se estime el tiempo que queda de procesamiento [en función del tiempo que ha tardado en procesar el nº de filas que llevamos en cada momento del bucle (por lo que va ir fluctuando porque si, por ejemplo, hay muchos NAs al principio va a tardar poco en procesarlos ya que no tiene que hacer ninguna operación y nos puede dar un tiempo estimado bajo, a medida que pase el bucle y vaya haciendo cálculos tardará más y por lo tanto la estimación cambiará)]:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Se imprime el porcentaje de procesado y la hora</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">==</span><span class="fu">round</span>(<span class="fu">nrow</span>(rmdf)<span class="sc">*</span>porcentaje)){</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  Hora_porcentaje<span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  diferencia_segundos <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(Hora_porcentaje, Hora_inicio, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  tiempo_restante_segundos <span class="ot">&lt;-</span> diferencia_segundos <span class="sc">/</span> (porcentaje) <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>porcentaje) </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  tiempo_restante_minutos <span class="ot">&lt;-</span> tiempo_restante_segundos <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  tiempo_restante_horas <span class="ot">&lt;-</span> tiempo_restante_minutos <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(porcentaje<span class="sc">*</span><span class="dv">100</span>, <span class="st">" % (hora: "</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%X, %d/%b/%Y) ---  Tiempo restante estimado: "</span>), <span class="fu">round</span>(tiempo_restante_horas), <span class="st">"h "</span>, <span class="fu">round</span>(tiempo_restante_minutos <span class="sc">%%</span> <span class="dv">60</span>), <span class="st">"min"</span>))</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(porcentaje<span class="sc">==</span><span class="dv">1</span>){ </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">print</span>(<span class="st">"-------------------------------   Proceso finalizado   --------------------------------------"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#definimos el siguiente porcentaje que se imprimirá</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  porcentaje<span class="ot">&lt;-</span>porcentaje<span class="fl">+0.02</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>Esto es totalmente opcional pero viene bien para comprobar que el código sigue funcionando</em> El output será el siguiente:</p>
<p><code>[1] "30 % (hora: 12:25:35, 11/Oct/2023) ---  Tiempo restante estimado:  4 h  50 min"</code></p>
</div>
</div>
<p>Y aquí concluye el código. Cuando acabe el proceso se imprimirá el siguiente mensaje:</p>
<p><code>[1] "-------------------------------   Proceso finalizado   --------------------------------------"</code></p>
</div>
</div>
</div>
<p>Y el resultado será algo como esto:</p>
<div class="cell">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-31bb33f70815889c5ced" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-31bb33f70815889c5ced">{"x":{"filter":"none","vertical":false,"extensions":["Buttons"],"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45"],["ACOT9","MACF1","CD44","CD44","NEDD4L","FNIP2","SYNE2","FGFR1","TJP1","KIAA1217","AFDN","SPIRE1","LPIN1","MAP3K7","ARHGAP17","LYST","ANK3","DST","DST","SCNN1G","VPS39","ZNF283","LIMK2","MYO6","MYO6","MYO6","DIAPH1","LMO7","ZNF35","PI4KA","ATG2B","ATG2B","RPS24","RPS24","EIF2D","EIF2D","NTMT1","NTMT1","NTMT1","NTMT1","STAT6","GPRC5C","GPRC5C","NEURL4","NEURL4"],["HsaEX0001973","HsaEX0037169","HsaEX0013865","HsaEX0013866","HsaEX0042432","HsaEX0026187","HsaEX0063188","HsaEX0025660","HsaEX0065036","HsaEX0033960","HsaEX0039566","HsaEX0061442","HsaEX0036266","HsaEX0037602","HsaEX0005421","HsaEX0037097","HsaEX0004154","HsaEX0021049","HsaEX1012417","HsaEX0056611","HsaEX0070604","HsaEX0000959","HsaEX1019694","HsaEX0041240","HsaEX0041241","HsaEX0041242","HsaEX0019673","HsaEX0036081","HsaEX0073504","HsaEX0047294","HsaALTA1004616-3/4","HsaALTA1004616-4/4","HsaALTA0007381-1/2","HsaALTA0007381-2/2","HsaALTA1032275-2/4","HsaALTA1032275-3/4","HsaALTA1034313-1/2","HsaALTA1034313-2/2","HsaALTD0003882-1/5","HsaALTD0003882-3/5","HsaALTD0006261-3/3","HsaALTD1035286-1/2","HsaALTD1035286-2/2","HsaALTD0004280-1/2","HsaALTD0004280-2/2"],[58,35,46,46,20,43,54,42,37,17,44,18,12,53,60,8,23,65,78,57,49,62,61,22,25,9,61,42,20,36,54,46,65,35,13,86,76,24,13,87,59,48,52,37,63],[23,65,20,19,52,69,20,68,70,48,18,53,47,86,89,50,54,32,33,85,14,88,31,77,78,42,33,13,79,76,15,85,30,70,41,59,49,51,41,56,32,79,21,9,91],[-35,30,-26,-27,32,26,-34,26,33,31,-26,35,35,33,29,42,31,-33,-45,28,-35,26,-30,55,53,33,-28,-29,59,40,-39,39,-35,35,28,-27,-27,27,28,-31,-27,31,-31,-28,28],[35,30,26,27,32,26,34,26,33,31,26,35,35,33,29,42,31,33,45,28,35,26,30,55,53,33,28,29,59,40,39,39,35,35,28,27,27,27,28,31,27,31,31,28,28],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.106842570638695,0.0808555983700523,0.0808555983700523,0.292348888499856,0.0808555983700523,0.264609895831667,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.0808555983700523,0.10653254833068,0.0808555983700523,0.50655516904904,0.50655516904904,0.0808555983700523,0.0808555983700523,0.184038627196425,0.190430263825524,0.387568030863149,0.387568030863149,0.411012423258406,0.384768368156195,0.0808555983700523,0.382733088885226,0.382733088885226,0.078629781321324,0.0786297813213241],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["chrX:23734341-23734367","chr1:39465095-39465112","chr11:35201082-35201195","chr11:35201671-35201787","chr18:58335478-58335537","chr4:158833801-158833890","chr14:64215286-64215354","chr8:38429682-38429948","chr15:29719777-29720016","chr10:24494500-24494604","chr6:167913403-167913423","chr18:12459755-12459928","chr2:11776089-11776193","chr6:90544552-90544632","chr16:24939364-24939597","chr1:235747170-235747331","chr10:60145968-60146021","chr6:56617986-56620715","chr6:56617241-56617418","chr16:23212058-23212151","chr15:42192066-42192098","chr19:43831318-43831381","chr22:31248385-31248769","chr6:75894814-75894840","chr6:75895231-75895260","chr6:75898373-75898411","chr5:141588224-141588250","chr13:75809154-75809183","chr3:44652557-44652701","chr22:20721298-20721418","chr14:96305589-96305812","chr14:96305589-96305815","chr10:78040204-78040225","chr10:78040201-78040225","chr1:206591642-206591842","chr1:206591642-206591845","chr9:129634058-129634149","chr9:129634054-129634149","chr9:129632650-129632801","chr9:129632650-129632869","chr12:57109941-57110110","chr17:74432133-74432141","chr17:74432133-74432523","chr17:7322954-7322964","chr17:7322948-7322964"],[27,18,114,117,60,90,69,267,240,105,21,174,105,81,234,162,54,2730,178,94,33,64,385,27,30,39,27,30,145,121,144,147,0,3,59,62,0,4,0,68,136,0,382,0,6],["chrX:23735886+23735919,23734332+23734341-23734367,23733211+23733217","chr1:39463686,39465095-39465112,39468615","chr11:35198246,35200646+35201082-35201195,35214852","chr11:35201195,35201668+35201671-35201787,35214852","chr18:58333892,58335478-58335537,58341038","chr4:158833628,158833801-158833890,158835405","chr14:64214470,64215286-64215354,64216248","chr8:38457356,38429682-38429948,38428435","chr15:29720358,29719777-29720016,29719002+29719138","chr10:24474060,24494500-24494604,24495147","chr6:167911489,167913403-167913423,167914168","chr18:12463351,12459755-12459928,12454483","chr2:11773745,11776086+11776089-11776193,11779046+11779519","chr6:90547258,90544495+90544552-90544632,90536401","chr16:24941987,24939364-24939597,24935639","chr1:235751210,235747170-235747331,235746527","chr10:60166824,60145968-60146021,60139087","chr6:56624530,56617986-56620715,56614484","chr6:56624530,56617241-56617418,56614484","chr16:23209848,23212034+23212058-23212151,23212678","chr15:42199896,42192066-42192098,42191560","chr19:43828281,43831279+43831318-43831381,43833505","chr22:31225819,31248385-31248769,31258291+31258299","chr6:75892690,75894814-75894840,75907605","chr6:75892690,75895231-75895260,75907605","chr6:75892690,75898373-75898411,75907605","chr5:141618798,141588224-141588250,141587197","chr13:75804541,75809154-75809183,75817161","chr3:44651259,44652557-44652701,44658701","chr22:20726488,20721298-20721418,20718822","chr14:96306714,96305589-96305668+96305809+96305812+96305815","chr14:96306714,96305589-96305668+96305809+96305812+96305815","chr10:78037304,78040204+78040201-78040225","chr10:78037304,78040204+78040201-78040225","chr1:206593619,206591642-206591783+206591842+206591845+206592243","chr1:206593619,206591642-206591783+206591842+206591845+206592243","chr9:129632801,129634058+129634054-129634149","chr9:129632801,129634058+129634054-129634149","chr9:129632650-129632801+129632865+129632869+129632873+129632981,129634058","chr9:129632650-129632801+129632865+129632869+129632873+129632981,129634058","chr12:57110077+57110043+57109941-57110110,57108299","chr17:74432133-74432141+74432523,74439745","chr17:74432133-74432141+74432523,74439745","chr17:7322954+7322948-7322964,7322866","chr17:7322954+7322948-7322964,7322866"],["S","S","C3","C3","C1","S","S","S","S","S","S","S","S","S","S","S","C2","C2","C2","S","S","C3","S","C2","C2","C2","S","C1","S","C3","Alt3","Alt3","Alt3","Alt3","Alt3","Alt3","Alt3","Alt3","Alt5","Alt5","Alt5","Alt5","Alt5","Alt5","Alt5"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>GENE<\/th>\n      <th>EVENT<\/th>\n      <th>Basal<\/th>\n      <th>Luminal<\/th>\n      <th>dPSI<\/th>\n      <th>range<\/th>\n      <th>Pass_threshold<\/th>\n      <th>pval<\/th>\n      <th>qval<\/th>\n      <th>COORD<\/th>\n      <th>LENGTH<\/th>\n      <th>FullCO<\/th>\n      <th>COMPLEX<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"paging":true,"scrollX":true,"searching":true,"ordering":true,"dom":"Bfrtip","buttons":["csv","excel"],"pageLength":5,"lengthMenu":[3,5,10],"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,7,8,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tener en cuenta que te guarda como rowname el nº de la fila de la INCLUSION_table en la que se encontraban los datos. No los vas a ver así en la siguiente gráfica porque lo he eliminado.</p>
</div>
</div>
<p>Una vez tenemos la tabla de datos podemos comenzar a realizar la representación gráfica de los mismos, la cual va a ser muy similar (tanto a nivel de código como visual) al análisis de expresión diferencial, solo que aquí representamos eventos de splicing:</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recuerda que los datos que utilizamos para graficar no son las medias sino los valores individuales de cada muestra. Estos valores no los hemos extraido en ningún momento en nuestro código anterior de manera que tenemos que recuperarlos. No lo he añadido para así poder ver un poco de manipulación de datos, que viene bien. Para recuprar estos valores he diseñado el siguiente código:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>PSI_pass_evets<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">2</span><span class="sc">+</span><span class="fu">length</span>(Samples_1)<span class="sc">+</span><span class="fu">length</span>(Samples_2)))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(PSI_pass_evets)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"GENE"</span>, <span class="st">"EVENT"</span>, Samples_1, Samples_2)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dPSI_df))){</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  PSI_pass_evets[n, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)]<span class="ot">&lt;-</span> dPSI_PASS[n, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  row_index<span class="ot">&lt;-</span> <span class="fu">which</span>(df<span class="sc">$</span>GENE <span class="sc">==</span> dPSI_PASS[n, <span class="dv">1</span>] <span class="sc">&amp;</span> df<span class="sc">$</span>EVENT <span class="sc">==</span> dPSI_PASS[n, <span class="dv">2</span>])</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">colnames</span>(PSI_pass_evets)[<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(PSI_pass_evets))]){</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    col_index<span class="ot">&lt;-</span> <span class="fu">which</span>(col <span class="sc">==</span> <span class="fu">colnames</span>(df))</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    PSI_pass_evets[n, col]<span class="ot">&lt;-</span> df[row_index, col_index]</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tener en cuenta que te guarda como rowname el nº de la fila de la INCLUSION_table en la que se encontraban los datos. No los vas a ver así en la siguiente gráfica porque lo he eliminado.</p>
</div>
</div>
<p>Y generamos algo así:</p>
<div class="cell">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-01f71e22ab0b8b8eec5b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-01f71e22ab0b8b8eec5b">{"x":{"filter":"none","vertical":false,"extensions":["Buttons"],"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45"],["ACOT9","MACF1","CD44","CD44","NEDD4L","FNIP2","SYNE2","FGFR1","TJP1","KIAA1217","AFDN","SPIRE1","LPIN1","MAP3K7","ARHGAP17","LYST","ANK3","DST","DST","SCNN1G","VPS39","ZNF283","LIMK2","MYO6","MYO6","MYO6","DIAPH1","LMO7","ZNF35","PI4KA","ATG2B","ATG2B","RPS24","RPS24","EIF2D","EIF2D","NTMT1","NTMT1","NTMT1","NTMT1","STAT6","GPRC5C","GPRC5C","NEURL4","NEURL4"],["HsaEX0001973","HsaEX0037169","HsaEX0013865","HsaEX0013866","HsaEX0042432","HsaEX0026187","HsaEX0063188","HsaEX0025660","HsaEX0065036","HsaEX0033960","HsaEX0039566","HsaEX0061442","HsaEX0036266","HsaEX0037602","HsaEX0005421","HsaEX0037097","HsaEX0004154","HsaEX0021049","HsaEX1012417","HsaEX0056611","HsaEX0070604","HsaEX0000959","HsaEX1019694","HsaEX0041240","HsaEX0041241","HsaEX0041242","HsaEX0019673","HsaEX0036081","HsaEX0073504","HsaEX0047294","HsaALTA1004616-3/4","HsaALTA1004616-4/4","HsaALTA0007381-1/2","HsaALTA0007381-2/2","HsaALTA1032275-2/4","HsaALTA1032275-3/4","HsaALTA1034313-1/2","HsaALTA1034313-2/2","HsaALTD0003882-1/5","HsaALTD0003882-3/5","HsaALTD0006261-3/3","HsaALTD1035286-1/2","HsaALTD1035286-2/2","HsaALTD0004280-1/2","HsaALTD0004280-2/2"],[64.37,39.58,45.21,43.93,21.9,55.87,57.28,37.16,37.27,23.01,47.49,18.06,10.86,53.25,70.97,7.2,27.28,67.73999999999999,81.66,56.52,50.47,63.73,59.51,26.72,28.63,12.14,70.16,43.25,15.92,52.71,76.12,23.88,70.84999999999999,29.15,40.23,59.77,77.38,22.62,9.630000000000001,89.84999999999999,42.97,62.5,37.5,30.17,69.83],[47.52,39.76,45.34,44.3,25.24,46.45,35.48,46.38,36.16,11.59,34.53,22.79,17.12,60.97,47.54,9.640000000000001,13.64,62.06,78.11,90.7,44.47,33.33,58.67,24.13,26.53,10.09,57.57,30.57,28.57,31.93,0,100,58.63,41.37,0,100,76.69,23.31,14.97,85.03,65.76000000000001,82.11,17.89,42.68,57.32],[61.06,25.59,48.84,48.32,12.54,25.46,69.09,41.58,37.61,15.07,49.51,13.68,8.619999999999999,45.31,62.5,7.78,29.38,64.55,73.61,25.27,51.49,90.28,65.56999999999999,15.09,21.11,5.61,56.22,52.51,15.66,23.77,84.58,15.42,66.38,33.62,0,98.67,74.81,25.19,13.67,84.78,66.84,0,100,37.23,62.77],[25.62,62.09,22.42,21.87,58.51,81.28,22,66.13,74.67,56.34,24.54,49.19,54.59,84.06,89.47,60,57.43,22.17,22.65,96.61,12.65,97.62,23.08,80.06,82.98999999999999,45.84,43.65,20.34,100,86.56999999999999,1.33,98.67,35.25,64.75,47.73,52.27,75.45999999999999,24.54,11.99,86.37,29.64,77.78,22.22,0,100],[17.55,72.03,14.54,13.4,55.91,65.28,14.29,73.18000000000001,65.06,36.65,9.529999999999999,54.77,37.04,92.43000000000001,86.11,45.45,32.39,28.67,27.84,97.05,8.59,100,29.32,68.37,68.40000000000001,32.64,26.23,7.89,100,74.41,42.5,57.5,25.44,74.56,42.42,57.58,0,100,96.15000000000001,0,35.55,71.43000000000001,28.57,0,100],[25.47,59.46,24,22.92,41.05,60.69,23.33,63.71,68.93000000000001,51.15,18.67,53.7,49.07,82.38,90.12,44.51,73.39,44.54,48.12,61.96,21.04,67.69,40.59,81.31999999999999,83.41,46.62,27.91,9.91,35.78,67.67,0,100,29.65,70.34999999999999,32.71,67.29000000000001,72.38,27.62,15.25,80.86,29.76,87.66,12.34,27.34,72.66]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>GENE<\/th>\n      <th>EVENT<\/th>\n      <th>Basal_1<\/th>\n      <th>Basal_2<\/th>\n      <th>Basal_3<\/th>\n      <th>Luminal_1<\/th>\n      <th>Luminal_2<\/th>\n      <th>Luminal_3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"paging":true,"scrollX":true,"searching":true,"ordering":true,"dom":"Bfrtip","buttons":["csv","excel"],"pageLength":5,"lengthMenu":[3,5,10],"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Y ahora tendríamos que crear la variable gathered (la matriz larga) para poder realizar las gráficas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>gathered_PSI <span class="ot">&lt;-</span> PSI_pass_evets <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="fu">colnames</span>(PSI_pass_evets)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(PSI_pass_evets)], <span class="at">key =</span> <span class="st">"Sample"</span>, <span class="at">value =</span> <span class="st">"PSI"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gathered_PSI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    GENE        EVENT  Sample   PSI
1  ACOT9 HsaEX0001973 Basal_1 64.37
2  MACF1 HsaEX0037169 Basal_1 39.58
3   CD44 HsaEX0013865 Basal_1 45.21
4   CD44 HsaEX0013866 Basal_1 43.93
5 NEDD4L HsaEX0042432 Basal_1 21.90
6  FNIP2 HsaEX0026187 Basal_1 55.87</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Estamos asumiendo que tenemos el metadata cargado porque lo habíamos utilizado para el análisis de expresión diferencial, si necesitáramos cargarlo sería poniendo el siguiente código para cargarlo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>metaData <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">read.csv</span>(<span class="st">'./Data/Metadata_Basal_vs_Luminal.csv'</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">row.name=</span><span class="dv">1</span>, <span class="at">sep =</span> <span class="st">","</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>metaData <span class="sc">%&gt;%</span>  <span class="fu">datatable</span>(<span class="at">extensions =</span> <span class="st">"Buttons"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">paging =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">scrollX=</span><span class="cn">TRUE</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">searching =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ordering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">dom =</span> <span class="st">'Bfrtip'</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">buttons =</span> <span class="fu">c</span>( <span class="st">'csv'</span>, <span class="st">'excel'</span>),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pageLength=</span><span class="dv">5</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">lengthMenu=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">10</span>) ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a59952141b4f85d0975f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a59952141b4f85d0975f">{"x":{"filter":"none","vertical":false,"extensions":["Buttons"],"data":[["Basal_1","Basal_2","Basal_3","Luminal_1","Luminal_2","Luminal_3"],["Basal","Basal","Basal","Luminal","Luminal","Luminal"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cell_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"paging":true,"scrollX":true,"searching":true,"ordering":true,"dom":"Bfrtip","buttons":["csv","excel"],"pageLength":5,"lengthMenu":[3,5,10],"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
<p>Por último, le atribuimos el grupo al que pertenece cada una de las muestras a utilizando el metadata:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>gathered_PSI <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(metaData <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Sample"</span>), gathered_PSI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(Sample)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gathered_PSI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Sample cell_type   GENE        EVENT   PSI
1 Basal_1     Basal  ACOT9 HsaEX0001973 64.37
2 Basal_1     Basal  MACF1 HsaEX0037169 39.58
3 Basal_1     Basal   CD44 HsaEX0013865 45.21
4 Basal_1     Basal   CD44 HsaEX0013866 43.93
5 Basal_1     Basal NEDD4L HsaEX0042432 21.90
6 Basal_1     Basal  FNIP2 HsaEX0026187 55.87</code></pre>
</div>
</div>
</div>
</div>
<ul>
<li>Boxplot de los más desregulados</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_PSI) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> EVENT, <span class="at">y =</span> PSI, <span class="at">fill =</span> cell_type)) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">"Events"</span>) <span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ylab</span>(<span class="st">"Inclusion levels (PSI)"</span>) <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="st">"Differencial Spliced Events"</span>) <span class="sc">+</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>GENE, <span class="at">scale=</span><span class="st">"free"</span>)<span class="sc">+</span> </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size=</span><span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AS_Analysis_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Esto son muchos genes pero si seleccionamos por ejemplo los 9 genes que presenten los eventos más diferencialmente spliceados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extraemos los 9 eventos con mayor diferencia de PSI</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>dPSI_df<span class="sc">$</span>dPSI<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dPSI_df<span class="sc">$</span>dPSI)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>eventList<span class="ot">&lt;-</span> <span class="fu">round</span>(dPSI_df<span class="sc">$</span>dPSI, <span class="at">digits=</span> <span class="dv">5</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(eventList)<span class="ot">&lt;-</span> dPSI_df<span class="sc">$</span>EVENT</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>Top_9_eventList<span class="ot">&lt;-</span> <span class="fu">sort</span>(eventList, <span class="at">decreasing =</span> T) <span class="sc">%&gt;%</span> .[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co">#hacemos el filtro para los 8 eventos con mayor diferencia de PSI</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>top9_PSI<span class="ot">&lt;-</span> PSI_pass_evets <span class="sc">%&gt;%</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">filter</span>(EVENT <span class="sc">%in%</span> <span class="fu">names</span>(Top_9_eventList)) </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Ahora hacemos el gathered</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>Top_9_gathered_events<span class="ot">&lt;-</span> top9_PSI <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gather</span>(<span class="fu">colnames</span>(PSI_pass_evets)[<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(PSI_pass_evets)], </span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">key =</span> <span class="st">"Sample"</span>, <span class="at">value =</span> <span class="st">"PSI"</span>) </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Añadimos el metadata</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>Top_9_gathered_events <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(metaData <span class="sc">%&gt;%</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Sample"</span>), Top_9_gathered_events)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="co">#y ahora graficamos el heatmap</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Top_9_gathered_events) <span class="sc">+</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> EVENT, <span class="at">y =</span> PSI, <span class="at">fill =</span> cell_type)) <span class="sc">+</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">"Events"</span>) <span class="sc">+</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ylab</span>(<span class="st">"Inclusion levels (PSI)"</span>) <span class="sc">+</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="st">"Differencial Spliced Events"</span>) <span class="sc">+</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>GENE, <span class="at">scale=</span><span class="st">"free"</span>)<span class="sc">+</span> </span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size=</span><span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AS_Analysis_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Heatmap</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Primero vamos a crear un data.frame(a partir de ahora "df") que va a ser igual que PSI_pass_events pero con con la columna de eventos como rownames y las columnas van a ser solo las muestras:</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>PSI_table<span class="ot">&lt;-</span> PSI_pass_evets <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>          .[, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"EVENT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate_if</span>(is.character, as.numeric)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Ahora creamos las anotaciones</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>annotation <span class="ot">&lt;-</span> metaData <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">"samplename"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(samplename, cell_type) <span class="sc">%&gt;%</span> </span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">row.names =</span> <span class="st">"samplename"</span>)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Y hacemos el heatmap</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(PSI_table, </span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(<span class="dv">6</span>, <span class="st">"YlOrRd"</span>))(<span class="dv">100</span>), </span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> T, </span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> F,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> F,</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation =</span> annotation, </span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">border_color =</span> <span class="cn">NA</span>, </span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize =</span> <span class="dv">10</span>, </span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"row"</span>, </span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">fontsize_row =</span> <span class="dv">10</span>, </span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AS_Analysis_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>PCA.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#definimos la varibale p como el cálculo de los Componentes Principales</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">pca</span>(PSI_table, <span class="at">metadata =</span> metaData, <span class="at">removeVar=</span><span class="fl">0.1</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Definimos una matriz de dos columnas para ver las dos gráficas juntas</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mflow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculamos el PC1vsPC2 bonito</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(p,</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">title =</span> <span class="st">"PC1 vs PC2"</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lab=</span><span class="cn">NULL</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">axisLabSize =</span> <span class="dv">10</span>,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colby=</span><span class="st">"cell_type"</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colkey =</span> <span class="fu">c</span>(<span class="st">"Basal"</span><span class="ot">=</span><span class="st">"forestgreen"</span>, <span class="st">"Luminal"</span><span class="ot">=</span><span class="st">"lightblue"</span>),</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">encircle =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">encircleFill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legendPosition =</span> <span class="st">"bottom"</span>,</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legendLabSize =</span> <span class="dv">8</span>,</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legendIconSize =</span> <span class="dv">4</span>,</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legendTitleSize =</span> <span class="dv">10</span>)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculamos múltiples PCAs</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span> <span class="fu">pairsplot</span>(p,</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">components =</span> <span class="fu">getComponents</span>(p, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">triangle =</span> <span class="cn">TRUE</span>, </span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">trianglelabSize =</span> <span class="dv">16</span>,</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">hline =</span> <span class="dv">0</span>, </span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">vline =</span> <span class="dv">0</span>,</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="dv">2</span>,</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">gridlines.major =</span> <span class="cn">FALSE</span>, </span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">gridlines.minor =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">'cell_type'</span>,</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'Pairs plot'</span>,</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">titleLabSize =</span> <span class="dv">12</span>,</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plotaxes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">margingaps =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="sc">-</span><span class="fl">0.01</span>, <span class="sc">-</span><span class="fl">0.01</span>, <span class="sc">-</span><span class="fl">0.01</span>), <span class="st">'cm'</span>))</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AS_Analysis_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Uso de <a href="https://vastdb.crg.eu/wiki/Main_Page"><code>VastDB</code></a>. Podemos buscar información muy útil relacionada con nuestro evento de interés en esta DataBase. Muy recomendable.</li>
</ul>
</section>
<section id="análisis-con-betas" class="level4" data-number="2.6.3.2">
<h4 data-number="2.6.3.2" class="anchored" data-anchor-id="análisis-con-betas"><span class="header-section-number">2.6.3.2</span> Análisis con betAS</h4>
<p>Esta herramienta ha sido desarrollada por Mariana Ascensão-Ferreira y Nuno L. Barbosa-Morais. También se ha publicado el <a href="https://www.biorxiv.org/content/biorxiv/early/2023/05/20/2022.12.26.521935.full.pdf">preprint</a> en <a href="https://www.biorxiv.org/content/10.1101/2022.12.26.521935v1.full">bioRxiv</a>:</p>
<p>Mariana Ascensão-Ferreira, Rita Martins-Silva, Nuno Saraiva-Agostinho and Nuno L. Barbosa-Morais (2023). betAS: intuitive analysis and visualisation of differential alternative splicing using beta distributions. bioRxiv</p>
<p>Para analizarlo con betAS podemos ir directamente a su página <a href="https://compbio.imm.medicina.ulisboa.pt/app/betAS">web interactiva</a> (similar a iDEP.96) o hacerlo en R (lo cual nos da un completo control de los datos). Tenemos que tener en cuenta que todavía es una herramienta en desarrollo.</p>
<p>La guía para R está en el siguiente <a href="https://diseasetranscriptomicslab.github.io/betAS/inst/betAS_tutorial.html">enlace</a></p>
<p>Para instalarlo en para R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"marianaferreira/betAS@dev"</span>) <span class="co">#Esto es provisional. El @dev significa que nos estamos descargando un "branch" de github en concreto (en este caso el que ellos han llamado "dev")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cargamos la libreía:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(betAS)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#además hay que instalar otras librerías recomendadas:</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly) </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se pueden <code>utilizar INCLUSION_tables.tab</code> generadas con <code>vast-tools</code>, los <code>MATS.JC.txt</code> genrados con <a href="https://rnaseq-mats.sourceforge.io/"><code>rMATS</code></a> o los <code>.psi.gz</code> generados para cada muestra mediante <a href="https://www.biorxiv.org/content/10.1101/158519v1.full"><code>whippet</code></a> mediante el uso de la función <code>getDataset</code>: - Para <code>vast-tools</code>:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example to load data from vast-tools</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">getDataset</span>(<span class="at">pathTables=</span><span class="st">"path/to/dataset/*INCLUSION_LEVELS_FULL*.tab"</span>, <span class="at">tool=</span><span class="st">"vast-tools"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example to load data from rMATS</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">getDataset</span>(<span class="at">pathTables=</span><span class="st">"path/to/dataset/*MATS.JC.txt"</span>, <span class="at">tool=</span><span class="st">"rMATS"</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example to load data from whippet</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">getDataset</span>(<span class="at">pathTables=</span><span class="fu">list</span>(<span class="st">"path/to/sample1/*.psi.gz"</span>,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"path/to/sample2/*.psi.gz"</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"path/to/sample3/*.psi.gz"</span>), <span class="at">tool=</span><span class="st">"whippet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Darnos cuenta de que lo último que definimos en esta función (<code>getDataset</code>) es la herramienta que utilizamos mediante el argumento <code>tool =</code>.</p>
<p>Otra cosa importante a tener en cuenta es que para utilizar la herramienta <code>whippet</code> hay que definir al menos dos archivos <code>.psi.gz</code>.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Vuelvo a trabajar en el terminal porque al tener que manipular la INCLUSION_table, ya vimos que es muy pesada así que es mejor trabajar ahí. Pero todo lo voy a hacer en R osea que se puede hacer en nuestr o ordenador.</p>
<p>De igual manera que he hecho anteriormente, dejaré un descargable de los datos tratatos para que podáis practicar</p>
</div>
</div>
<p>Para nuestro caso concreto sería:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">getDataset</span>(<span class="at">pathTables=</span><span class="st">"INCLUSION_LEVELS_FULL-hg38-6.tab"</span>, <span class="at">tool=</span><span class="st">"vast-tools"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>tool <span class="ot">&lt;-</span> <span class="st">"vast-tools"</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">getEvents</span>(dataset, <span class="at">tool =</span> tool)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Esto crea un objeto que guarda tanto los valores de PSI como los de calidad en una especie de dataset simultáneos con las mismas características (como hacía <code>DESeq2</code>).</p>
<p>Podemos realizar un filtro por tipo de evento. Por ejemplo, con el siguiente comando podemos quedarnos con los exon skipping solamente (el <code>N=10</code>hará que solo consideremos aquellos eventos de los que hayamos tenido un mínimo de 10 eventos):</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>dataset_filtered <span class="ot">&lt;-</span> <span class="fu">filterEvents</span>(dataset, <span class="at">types=</span><span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"S"</span>, <span class="st">"MIC"</span>), <span class="at">N=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez hemos cargado y formateado nuestro dataset para poder utilizarlo, podemos realizar los filtros que queramos, por ejemplo:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dataset_filtered <span class="ot">&lt;-</span> <span class="fu">alternativeEvents</span>(dataset_filtered, <span class="at">minPsi=</span><span class="dv">1</span>, <span class="at">maxPsi=</span><span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación podemos hacer una representación de la distribución del PSI por muestra (en el eje de la y tenemos la :</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>bigPicturePlot <span class="ot">&lt;-</span> <span class="fu">bigPicturePlot</span>(<span class="at">table =</span> dataset_filtered<span class="sc">$</span>PSI)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#tenemos que indicar que queremos queremos ver la distribución del objeto PSI</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>bigPicturePlot <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture31.png" class="img-fluid"></p>
<p>A continuación tenemos que definir los grupos para así poder hacer el análisis. Para ello:</p>
<ol type="1">
<li>Leemos el archivo de metadata como un dataframe:</li>
</ol>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>metadata<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">read.csv</span>(<span class="st">"Data/Metadata_Basal_vs_Luminal.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Definimos la variable “cell_type” com la variable con la que vamos a definir los grupos y guardamos los grupos en la variable <code>groups</code> y las muestras en la varieble <code>samples</code>:</li>
</ol>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>groupingVariable <span class="ot">&lt;-</span> <span class="st">"cell_type"</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">unique</span>(metadata[,groupingVariable])</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#tener cuidado porque esta variable tiene que estar definida como caracter. Si tenemos algún error probar con lo siguiente:</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co">#groups &lt;- as.character(unique(metadata[,groupingVariable]))</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> metadata<span class="sc">$</span>id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Vamos a representar una pie chart de la distribución de las muestras</li>
</ol>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FF9AA2"</span>, <span class="st">"#AFAAD1"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>groupList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(groups)){</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  groupNames <span class="ot">&lt;-</span> samples[<span class="fu">which</span>(metadata[,groupingVariable] <span class="sc">==</span> groups[i])]</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign new group</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  currentNames <span class="ot">&lt;-</span> <span class="fu">names</span>(groupList)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  groupList[[<span class="fu">length</span>(groupList)<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">name =</span> groups[i],</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">samples =</span> groupNames,</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">color =</span> colors[i])</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(groupList) <span class="ot">&lt;-</span> <span class="fu">make.unique</span>(<span class="fu">c</span>(currentNames, groups[i]))</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>slices <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(groups))</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(slices, <span class="at">col =</span> colors[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(groups)], <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">labels=</span>groups, <span class="at">main =</span> <span class="st">"Color palette for group definition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AS_Analysis_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Explicación código del pie chart" data-collpse="TRUE">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explicación código del pie chart
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Comenzamos definiendo los colores que vamos a utilizar. Como tenemos dos grupos solo vamos a definir dos colores:</li>
</ol>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FF9AA2"</span>, <span class="st">"#AFAAD1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>A continuación creamos una lista para asignar a cada grupo un color (con el bucle a continuación):</li>
</ol>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>groupList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(groups)){</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  groupNames <span class="ot">&lt;-</span> samples[<span class="fu">which</span>(metadata[,groupingVariable] <span class="sc">==</span> groups[i])]</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asignamos un nuevo grupo</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  currentNames <span class="ot">&lt;-</span> <span class="fu">names</span>(groupList)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  groupList[[<span class="fu">length</span>(groupList)<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">name =</span> groups[i],</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">samples =</span> groupNames,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">color =</span> colors[i])</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(groupList) <span class="ot">&lt;-</span> <span class="fu">make.unique</span>(<span class="fu">c</span>(currentNames, groups[i]))</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualicemos como queda la lista</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Definimos el tamaño de las slices de las pie chart</li>
</ol>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>slices <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(groups))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Por úlimo graficamos el pie chart:</li>
</ol>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(slices, <span class="at">col =</span> colors[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(groups)], <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">labels=</span>groups, <span class="at">main =</span> <span class="st">"Color palette for group definition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AS_Analysis_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<p>Ahora es cuando viene la parte interesante de betAS por que comienza el <strong>análisis de splicing diferencial</strong>. La estadística del splicing diferencial se basa en la distribución beta de los eventos de splicnig como hemos mencionado anteriormente. Para ello, betAS calcula los siguientes parámetros para calcular la significancia:</p>
<ul>
<li><strong>P<sub>diff<sub></sub></sub></strong>. Este enfoque toma los dos conjuntos de puntos aleatorios por condición y calcula, para el ∆PSI estimado de cada evento AS, la proporción de diferencias entre estos que son mayores que cero, lo que tiene la misma interpretación que preguntarse qué proporción de valores emitidos por la distribución beta para una condición son mayores que los emitidos para la otra, reflejando así la probabilidad de que el AS diferencial de PSI<sub>betAS<sub>(grupo A) sea mayor que PSI<sub>betAS<sub>(grupo B).</sub></sub></sub></sub></li>
</ul>
<p>-<strong>F-estadística</strong>. betAS también permite realizar un análisis de varianza similar al ANOVA, comparando las variabilidades intergrupo e intragrupo. Para cada evento, within se considera el conjunto de diferencias entre cada par de muestras que forman parte del mismo grupo y between el conjunto de diferencias entre cada par de grupos. El cociente de los valores absolutos medios de between e within proporciona, por tanto, un estadístico “tipo F”. Esta métrica proporciona un compromiso entre el tamaño del efecto de las diferencias AS y su significación.</p>
<p>-<strong>FDR</strong>. Se utiliza la generación aleatoria de puntos a partir de una distribución beta para estimar la distribución nula del PSI y su precisión. A continuación, se selecciona aleatoriamente un punto de cada distribución nula de la muestra y, manteniendo la asignación de grupos de las muestras (es decir, qué muestras pertenecen a cada grupo), se calcula el ∆PSI entre grupos bajo la hipótesis nula. El proceso se repite muchas veces (10 000 por defecto) y el FDR es la proporción de simulaciones aleatorias ∆PSI que son mayores (es decir, más extremas) o iguales que el ∆PSI empírico.</p>
<p>Primero comenzamos definiendo el nombre de los grupos de forma compatible con las funciones que vamos a utilizar:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>groupA    <span class="ot">&lt;-</span> <span class="st">"Basal"</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>groupB    <span class="ot">&lt;-</span> <span class="st">"Luminal"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Definimos las muestras que hay dentro de cada grupo:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>samplesA    <span class="ot">&lt;-</span> groupList[[groupA]]<span class="sc">$</span>samples</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>samplesB    <span class="ot">&lt;-</span> groupList[[groupB]]<span class="sc">$</span>samples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y convertimos las muestras en índices:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>colsGroupA    <span class="ot">&lt;-</span> <span class="fu">convertCols</span>(dataset_filtered<span class="sc">$</span>PSI, samplesA)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>colsGroupB    <span class="ot">&lt;-</span> <span class="fu">convertCols</span>(dataset_filtered<span class="sc">$</span>PSI, samplesB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>P<sub>diff<sub></sub></sub></strong> A continuación calculamos la probabilidad de differential splicing (P<sub>diff<sub>) entre los grupos para cada evento con la función <code>prepareTableVolcano</code>.</sub></sub></li>
</ul>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>volcanoTable_Pdiff <span class="ot">&lt;-</span> <span class="fu">prepareTableVolcano</span>(<span class="at">psitable =</span> dataset_filtered<span class="sc">$</span>PSI,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">qualtable =</span> dataset_filtered<span class="sc">$</span>Qual,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">npoints =</span> <span class="dv">500</span>,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colsA =</span> colsGroupA,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colsB =</span> colsGroupB,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labA =</span> groupA,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labB =</span> groupB,</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maxDevTable =</span> maxDevSimulationN100)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(volcanoTable_Pdiff[,<span class="fu">c</span>(<span class="st">"GENE"</span>,<span class="st">"EVENT"</span>,<span class="st">"COORD"</span>,<span class="st">"Pdiff"</span>,<span class="st">"deltapsi"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture32.png" class="img-fluid"></p>
<p>A continuación podemos graficar por ejemplo un volcano plot (la función <code>plotVolcano</code> está basaada en <code>ggplot2</code> de manera que podemos aplicar funciones como <code>theme()</code> para modificar la gráfica):</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVolcano</span>(<span class="at">betasTable =</span> volcanoTable_Pdiff,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labA =</span> groupA,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labB =</span> groupB,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>) <span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Volcano plot of Pdiff of ΔPSI"</span>)<span class="sc">+</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#con theme podemos cambiar muchas varibales a nuestro gusto</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">15</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x=</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),<span class="co"># Tamaño de los labels en el eje X</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)   <span class="co"># Tamaño de los labels en el eje Y</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co">#no he encontrado la forma de cambiar los puntos de tamaño</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture33.png" class="img-fluid"></p>
<ul>
<li><strong>F-statistic</strong> Para calcular la F-estadística las funciones son similares a la que utilizamos para Pdiff. Comenzamos calculando este parámetro:</li>
</ul>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>volcanoTable_Fstat <span class="ot">&lt;-</span> <span class="fu">prepareTableVolcanoFstat</span>(<span class="at">psitable =</span> dataset_filtered<span class="sc">$</span>PSI,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">qualtable =</span> dataset_filtered<span class="sc">$</span>Qual,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">npoints =</span> <span class="dv">500</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colsA =</span> colsGroupA,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colsB =</span> colsGroupB,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labA =</span> groupA,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labB =</span> groupB,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maxDevTable =</span> maxDevSimulationN100)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(volcanoTable_Fstat[,<span class="fu">c</span>(<span class="st">"GENE"</span>,<span class="st">"EVENT"</span>,<span class="st">"COORD"</span>,<span class="st">"Fstat"</span>,<span class="st">"deltapsi"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture34.png" class="img-fluid"></p>
<p>Y ahora podemos representar el volcano plot:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVolcanoFstat</span>(<span class="at">betasTable =</span> volcanoTable_Fstat,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labA =</span> groupA,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labB =</span> groupB,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>) <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Volcano plot of F-stat of ΔPSI"</span>)<span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">15</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x=</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),<span class="co"># Tamaño de los labels en el eje X</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)   <span class="co"># Tamaño de los labels en el eje Y</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co">#no he encontrado la forma de cambiar los puntos de tamaño</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture35.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Se que estas gráficas están muy feas. Podríamos tener el control absoluto con <code>ggplot</code> + <code>geom_point</code> pero no me voy a parar ahora.</p>
</div>
</div>
<ul>
<li><strong>FDR</strong> Para calcular el FDR las funciones vuelven a ser similares a las utilizamos previamente. Comenzamos calculando este parámetro:</li>
</ul>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>volcanoTable_FDR <span class="ot">&lt;-</span> <span class="fu">prepareTableVolcanoFDR</span>(<span class="at">psitable =</span> dataset_filtered<span class="sc">$</span>PSI,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">qualtable =</span> dataset_filtered<span class="sc">$</span>Qual,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">npoints =</span> <span class="dv">500</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colsA =</span> colsGroupA,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colsB =</span> colsGroupB,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labA =</span> groupA,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labB =</span> groupB,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maxDevTable =</span> maxDevSimulationN100,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">nsim =</span> <span class="dv">100</span>) </span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(volcanoTable_FDR[,<span class="fu">c</span>(<span class="st">"GENE"</span>,<span class="st">"EVENT"</span>,<span class="st">"COORD"</span>,<span class="st">"FDR"</span>,<span class="st">"deltapsi"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture36.png" class="img-fluid"></p>
<p>Y volvemos a utilizar la función prefedefinida para representar un volcano:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVolcanoFDR</span>(<span class="at">betasTable =</span> volcanoTable_FDR,</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labA =</span> groupA,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labB =</span> groupB,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Volcano plot of FDR of ΔPSI"</span>)<span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">15</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x=</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),<span class="co"># Tamaño de los labels en el eje X</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)   <span class="co"># Tamaño de los labels en el eje Y</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture37.png" class="img-fluid"></p>
<ul>
<li>Representación de eventos de interés: Vamos a representar el evento “HsaEX0041241” que fue uno de los que nos salió en mi análisis handmade a ver que sale. Con betAS podemos hacer gráficas muy chulas.</li>
</ul>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#primero definimos el evento</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>eventID<span class="ot">&lt;-</span><span class="st">"HsaEX0041241"</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>tdensities <span class="ot">&lt;-</span> <span class="fu">plotIndividualDensitiesList</span>(<span class="at">eventID =</span> eventID,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">npoints =</span> <span class="dv">500</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">psitable =</span> dataset<span class="sc">$</span>PSI,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">qualtable =</span> dataset<span class="sc">$</span>Qual,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">groupList =</span> groupList,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">maxDevTable =</span> maxDevSimulationN100)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>tdensities <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(eventID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture38.png" class="img-fluid"></p>
<p>Otra gráfica chula es la siguiente:</p>
<div class="cell" data-fig.showtext="false">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>plotPdiff <span class="ot">&lt;-</span> <span class="fu">prepareTableEvent</span>(<span class="at">eventID =</span> eventID,</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">psitable =</span> dataset<span class="sc">$</span>PSI,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">qualtable =</span> dataset<span class="sc">$</span>Qual,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">npoints =</span> <span class="dv">500</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colsA =</span> colsGroupA,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colsB =</span> colsGroupB,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labA =</span> groupA,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labB =</span> groupB,</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">maxDevTable =</span> maxDevSimulationN100,</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nsim =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotPDiffFromEventObjList</span>()<span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">15</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x=</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),<span class="co"># Tamaño de los labels en el eje X</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)   <span class="co"># Tamaño de los labels en el eje Y</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>plotFstat <span class="ot">&lt;-</span> <span class="fu">prepareTableEvent</span>(<span class="at">eventID =</span> eventID,</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>                               <span class="at">psitable =</span> dataset<span class="sc">$</span>PSI,</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>                               <span class="at">qualtable =</span> dataset<span class="sc">$</span>Qual,</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>                               <span class="at">npoints =</span> <span class="dv">500</span>,</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colsA =</span> colsGroupA,</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colsB =</span> colsGroupB,</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labA =</span> groupA,</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labB =</span> groupB,</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>                               <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>                               <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>,</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>                               <span class="at">maxDevTable =</span> maxDevSimulationN100,</span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nsim =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotFstatFromEventObjList</span>()<span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">15</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x=</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),<span class="co"># Tamaño de los labels en el eje X</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)   <span class="co"># Tamaño de los labels en el eje Y</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>plotFDR <span class="ot">&lt;-</span> <span class="fu">prepareTableEvent</span>(<span class="at">eventID =</span> eventID,</span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>                               <span class="at">psitable =</span> dataset<span class="sc">$</span>PSI,</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>                               <span class="at">qualtable =</span> dataset<span class="sc">$</span>Qual,</span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>                               <span class="at">npoints =</span> <span class="dv">500</span>,</span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colsA =</span> colsGroupA,</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colsB =</span> colsGroupB,</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labA =</span> groupA,</span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labB =</span> groupB,</span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>                               <span class="at">basalColor =</span> <span class="st">"#89C0AE"</span>,</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>                               <span class="at">interestColor =</span> <span class="st">"#E69A9C"</span>,</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a>                               <span class="at">maxDevTable =</span> maxDevSimulationN100,</span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nsim =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plotFDRFromEventObjList</span>()<span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span> <span class="dv">15</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x=</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),<span class="co"># Tamaño de los labels en el eje X</span></span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)   <span class="co"># Tamaño de los labels en el eje Y</span></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(plotPdiff,plotFstat,plotFDR, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./Images/Picture39.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>De nuevo, estas gráficas están muy feas. Podríamos tener el control absoluto con <code>ggplot</code> + <code>geom_point</code> pero no me voy a parar ahora.</p>
</div>
</div>
<ul>
<li><strong>Comparación entre varios grupos</strong>. Para esto podemos ir al punto 6 del <a href="https://diseasetranscriptomicslab.github.io/betAS/inst/betAS_tutorial.html">vignette</a>.</li>
</ul>
</section>
</section>
</section>
<section id="analisis-de-enriquecimiento-de-differenctial-splicing" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="analisis-de-enriquecimiento-de-differenctial-splicing"><span class="header-section-number">2.7</span> Analisis de Enriquecimiento de Differenctial Splicing</h2>
<section id="paquete-1" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="paquete-1"><span class="header-section-number">2.7.1</span> Paquete 1</h3>
</section>
<section id="paquete-2" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="paquete-2"><span class="header-section-number">2.7.2</span> Paquete 2</h3>
</section>
</section>
</section>
<section id="otros-paquetes-de-interés" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Otros paquetes de interés</h1>
<section id="psichomics" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="psichomics"><span class="header-section-number">3.1</span> PSIchomics</h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>